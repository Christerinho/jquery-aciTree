
/*
 * aciTree jQuery Plugin v2.2.0
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.7.1 http://jquery.com
 * + aciPlugin >= v1.1.0 https://github.com/dragosu/jquery-aciPlugin
 *
 * Date: Thu Mar 14 20:10 2013 +0200
 */

// core
(function(b){var a={jsonUrl:null,rootData:null,threads:4,queueDelay:40,loaderDelay:500,expand:false,collapse:false,unique:false,empty:false,show:{props:{height:"show"},duration:"medium",easing:"linear"},animateRoot:true,hide:{props:{height:"hide"},duration:"medium",easing:"linear"},view:{duration:"medium",easing:"linear"},callbacks:{item:null}};var c={__extend:function(){b.extend(this._instance,{locked:false,_loadQueue:new this._queue(this._instance.options.threads,false,this._instance.options.queueDelay),_loaderHide:null,_loaderInterval:null})},init:function(){var g=this;if(g.wasInit()){g._trigger(null,"wasinit");return false}if(g.isLocked()){g._trigger(null,"locked");return false}g._instance.locked=true;g._instance.jQuery.on("click"+g._instance.nameSpace,"div.aciTreeButton",function(i){var h=b(i.target).parent();g.toggle(h,{collapse:g._instance.options.collapse,expand:g._instance.options.expand,unique:g._instance.options.unique})});g._init();var e=g._super;var f=function(){e.apply(g);g._instance.locked=false;g._trigger(null,"init")};var d=function(){e.apply(g);g._instance.locked=false;g._trigger(null,"initfail")};if(g._instance.options.rootData){g.initFrom(null,{success:f,fail:d,itemData:g._instance.options.rootData})}else{if(g._instance.options.jsonUrl){g.ajaxLoad(null,{success:f,fail:d})}else{f()}}return true},_init:function(){},isLocked:function(){return this._instance.locked},_queue:function(i,d,g){var h=[];var k=[];var e=i?Math.max(i,1):1;var j=0;var f=false;this.push=function(m,l){if(!f){h.push({callback:m,async:l})}return this};this.complete=function(m,l){if(!f){k.push({callback:m,async:l})}return this};this.destroy=function(){f=true;setTimeout(function(){k=[];h=[];j=0;f=false},g)};this.busy=function(){return j>=e};this.empty=function(){return(j==0)&&(h.length==0)&&(k.length==0)};this.run=function(o){if((j>=e)||f){return}if(o){for(var n=1,m=e-j;n<m;n++){this.run()}}var l=this;setTimeout(function(){if((j>=e)||f){return}var p=h.shift();if(!p){if(h.length){setTimeout(function(){l.run()},10)}else{p=k.shift()}}if(p){if(p.async){j++;p.callback(function(){j--;l.run()})}else{j++;p.callback();j--;l.run()}}},d?10:g)}},_options:function(f,g,d){var e=b.extend({success:null,fail:null,expand:false,collapse:false,unique:false,unanimated:false,itemData:null},f);if(g){if(f&&f.success){e.success=function(){g();f.success()}}else{e.success=g}}if(d){if(f&&f.fail){e.fail=function(){d();f.fail()}}else{e.fail=d}}return e},_trigger:function(e,d,f){f=b.extend({event:d},f);this._instance.jQuery.trigger("acitree",[this,e?e.first():null,f])},_success:function(e,d,f){if(d&&d.success){d.success(this,e?e.first():null,f)}},_fail:function(e,d,f){if(d&&d.fail){d.fail(this,e?e.first():null,f)}},ajaxLoad:function(e,d){var f=this;d=f._options(d,function(){f._loading(e,false);f._trigger(e,"loaded")},function(){f._loading(e,false);f._trigger(e,"loadfail")});if(!e||f.isFolder(e)){f._instance._loadQueue.push(function(g){if(f.wasLoad(e)){f._success(e,d);g();return}f._loading(e,true);b.get(f._instance.options.jsonUrl+(e?f.getId(e):""),function(h){if(h&&(h instanceof Array)&&h.length){var i=function(){if(f.wasLoad(e)){f.unload(e,{success:function(){f._branch(e,h);f._success(e,d);g()},fail:function(){f._fail(e,d);g()},unanimated:d.unanimated})}else{f._branch(e,h);f._success(e,d);g()}};f.setFolder(e,{success:i,fail:i})}else{var i=function(){f._fail(e,d);g()};f.setFile(e,{success:i,fail:i})}},"json").fail(function(){f._fail(e,d);g()})},true).run()}else{f._fail(e,d)}},initFrom:function(e,d){var g=this;d=g._options(d,function(){g._loading(e,false);g._trigger(e,"loaded")},function(){g._loading(e,false);g._trigger(e,"loadfail")});if(!e||g.isFolder(e)){if(g.wasLoad(e)){g._success(e,d);return}g._loading(e,true);if(d.itemData&&(d.itemData instanceof Array)&&d.itemData.length){var f=function(){if(g.wasLoad(e)){g.unload(e,{success:function(){g._branch(e,d.itemData);g._success(e,d)},fail:d.fail,unanimated:d.unanimated})}else{g._branch(e,d.itemData);g._success(e,d)}};g.setFolder(e,{success:f,fail:f})}else{g.setFile(e,{success:d.fail,fail:d.fail})}}else{g._fail(e,d)}},unload:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"unloaded")},function(){f._trigger(e,"unloadfail")});if(!e||f.isFolder(e)){f._loading(e,true);f.childrens(e,true).each(function(){var g=b(this);if(f.isFolder(g)){f._trigger(g,"closed");f._trigger(g,"unloaded")}f._trigger(g,"removed")});if(e){if(f.isOpen(e)){f.close(e,{success:function(){f._loading(e);f._ensure(e);f._success(e,d)},fail:function(){f._loading(e);f._fail(e,d)},unanimated:d.unanimated})}else{f._loading(e);f._ensure(e);f._success(e,d)}}else{f._animate(e,false,!f._instance.options.animateRoot||d.unanimated,function(){f._loading(e);f._ensure(e);f._success(e,d)})}}else{f._fail(e,d)}},remove:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"removed")},function(){f._trigger(e,"removefail")});if(f.isItem(e)){if(f.isFolder(e)){if(f.wasLoad(e)){f.unload(e,{success:function(){f._success(e,d);e.remove()},fail:d.fail,unanimated:d.unanimated})}else{f._success(e,d);e.remove()}}else{f._success(e,d);e.remove()}}else{f._fail(e,d)}},_openChilds:function(f,e){var g=this;if(e.expand){var d=new g._queue(g._instance.options.threads,true,g._instance.options.queueDelay);g.childrens(f).each(function(){var h=b(this);if(g.isFolder(h)){if(g.isOpen(h)){g._trigger(h,"opened")}else{d.push(function(i){g.open(h,{success:i,fail:i,expand:true,unanimated:e.unanimated})},true)}}});d.complete(function(){g._success(f,e)}).run(true)}else{g._success(f,e)}},_openItem:function(e,d){var f=this;if(!d.unanimated&&!f.isVisible(e)){d.unanimated=true}if(d.unique){f.closeOthers(e);d.unique=false}e.addClass("aciTreeOpen");f._animate(e,true,d.unanimated,function(){f._openChilds(e,d)})},open:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"opened")},function(){f._trigger(e,"openfail")});if(f.isFolder(e)){if(f.isOpen(e)){f._openChilds(e,d)}else{if(f.wasLoad(e)){f._openItem(e,d)}else{f.ajaxLoad(e,{success:function(){f._openItem(e,d)},fail:d.fail})}}}else{f._fail(e,d)}},_closeChilds:function(f,e){var g=this;if(g._instance.options.empty){e.unanimated=true;g.unload(f,e)}else{if(e.collapse){var d=new g._queue(g._instance.options.threads,true,g._instance.options.queueDelay);g.childrens(f).each(function(){var h=b(this);if(g.isFolder(h)){if(g.isOpen(h)){d.push(function(i){g.close(h,{success:i,fail:i,collapse:true,unanimated:true})},true)}else{g._trigger(h,"closed")}}});d.complete(function(){g._success(f,e)}).run(true)}else{g._success(f,e)}}},_closeItem:function(e,d){var f=this;if(!d.unanimated&&!f.isVisible(e)){d.unanimated=true}e.removeClass("aciTreeOpen");f._animate(e,false,d.unanimated,function(){f._closeChilds(e,d)})},close:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"closed")},function(){f._trigger(e,"closefail")});if(f.isFolder(e)){if(f.isOpen(e)){f._closeItem(e,d)}else{if(f.wasLoad(e)){f._closeChilds(e,d)}else{f._success(e,d)}}}else{f._fail(e,d)}},closeOthers:function(g,f){var h=this;f=h._options(f);if(h.isItem(g)){var d=new h._queue(h._instance.options.threads,true,h._instance.options.queueDelay);var e=g.add(h.getPath(g)).add(h.childrens(g,true));h.childrens(null,true).filter(".aciTreeOpen").not(e).each(function(){var i=b(this);d.push(function(j){h.close(i,{success:j,fail:j,unanimated:f.unanimated})},true)});d.complete(function(){h._success(g,f)}).run(true)}else{h._fail(g,f)}},toggle:function(e,d){if(this.isOpen(e)){this.close(e,d)}else{this.open(e,d)}},getPath:function(e,d){if(e){var f=function(h){var i=[];var g=h.parent().parent();if(g.hasClass("aciTreeLi")){i=d?i.concat(g.get(0),f(g)):i.concat(f(g),g.get(0))}return i};return b(f(e.first()))}return b([])},isVisible:function(g){var j=this;var h=true;j.getPath(g).each(function(){if(!j.isOpen(b(this))){h=false;return false}});if(h&&j.isItem(g)){var f=j._instance.jQuery.get(0).getBoundingClientRect();var e=g.first().find(">div.aciTreeItem");var i=e.get(0).getBoundingClientRect();var d=e.outerHeight(true);if((i.bottom-d<f.top)||(i.top+d>f.bottom)||(i.right<f.left)||(i.left>f.right)){return false}return true}return false},openPath:function(f,e){var h=this;e=h._options(e);var g=h.getPath(f);if(g.length){var d=new h._queue(null,true,h._instance.options.queueDelay);g.each(function(){var i=b(this);if(h.isOpen(i)){h._trigger(i,"opened")}else{d.push(function(j){h.open(i,{success:j,fail:j,unanimated:e.unanimated})},true)}});d.complete(function(){h._success(f,e)}).run()}else{h._fail(f,e)}},_speedFraction:function(f,d,g){if(g<d){var e=parseInt(f);if(isNaN(e)){switch(f){case"slow":e=600;break;case"medium":e=400;break;case"fast":e=200;break;default:return f}}return e*g/d}return f},setVisible:function(f,e){var g=this;e=g._options(e);if(g.isVisible(f)){g._success(f,e)}else{if(g.isItem(f)){var d=function(){var j=g._instance.jQuery.get(0).getBoundingClientRect();var i=f.first().find(">div.aciTreeItem");var l=i.get(0).getBoundingClientRect();var h=i.outerHeight(true);if(l.bottom-h<j.top){var k=j.top-l.bottom+h;if(!e.unanimated&&g._instance.options.view){g._instance.jQuery.stop(true).animate({scrollTop:g._instance.jQuery.scrollTop()-k},{duration:g._speedFraction(g._instance.options.view.duration,j.bottom-j.top,k),easing:g._instance.options.view.easing,complete:function(){g._success(f,e)}})}else{g._instance.jQuery.stop(true).get(0).scrollTop=g._instance.jQuery.scrollTop()-k;g._success(f,e)}}else{if(l.top+h>j.bottom){var k=l.top-j.bottom+h;if(!e.unanimated&&g._instance.options.view){g._instance.jQuery.stop(true).animate({scrollTop:g._instance.jQuery.scrollTop()+k},{duration:g._speedFraction(g._instance.options.view.duration,j.bottom-j.top,k),easing:g._instance.options.view.easing,complete:function(){g._success(f,e)}})}else{g._instance.jQuery.stop(true).get(0).scrollTop=g._instance.jQuery.scrollTop()+k;g._success(f,e)}}else{g._success(f,e)}}};if(g.haveParent(f)){g.openPath(f,{success:d,fail:e.fail})}else{d()}}else{g._fail(f,e)}}},haveParent:function(e){if(e){var d=e.first().parent().parent();return d.hasClass("aciTreeLi")}return false},getParent:function(d){return d?d.first().parent().parent().filter("li.aciTreeLi"):b([])},getTopParent:function(d){if(this.isItem(d)){var e=this.getPath(d);return e.length?e.eq(0):b([])}return b([])},_branch:function(h,e){if(h){h.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder")}var f=this.append(h,{itemData:e});var d;for(var g in e){d=e[g];if(d.items&&(d.items instanceof Array)&&d.items.length){this._branch(f.eq(g),d.items)}if(d.props&&d.props.open){this.open(f.eq(g))}}},_item:function(e,f,d,g){if(this._instance.options.callbacks&&this._instance.options.callbacks.item){this._instance.options.callbacks.item(e,f,d,g);return}this.setItem(f,d.item)},_create:function(e,g,h){var d=b('<li class="aciTreeLi"></li>').data("id"+this._instance.nameSpace,e.id);var f='<div class="aciTreeButton"><div></div></div><div class="aciTreeItem">';if(e.props&&e.props.icon){if(e.props.icon instanceof Array){f+='<div class="aciTreeIcon '+e.props.icon[0]+'" style="background-position:'+e.props.icon[1]+"px "+e.props.icon[2]+'px"></div>'}else{f+='<div class="aciTreeIcon '+e.props.icon+'"></div>'}}d.append(f+"</div>");if(e.props&&(e.props.isFolder||(e.props.isFolder===null))){d.addClass((e.props.isFolder||(e.items&&e.items.length))?"aciTreeFolder":"aciTreeFolderMaybe")}else{d.addClass("aciTreeFile")}this._item(this,d,e,h);return d},_insert:function(g,h,k,d,j,l){if(d){var e=[];if(d instanceof Array){for(var f in d){e[e.length]=this._create(d[f],j,l).get(0)}}else{e[e.length]=this._create(d,j,l).get(0)}e=b(e);if(g){g.append(e)}else{if(h){h.before(e)}else{if(k){k.after(e)}}}return e}return b([])},_ensure:function(e,f){if(!e){e=this._instance.jQuery}var d=e.find(">ul.aciTreeUl");if(f){if(!d.length){d=b('<ul class="aciTreeUl" style="display:none"></ul>');e.append(d)}return d}d.remove()},append:function(f,d){var h=this;d=h._options(d,function(){h._trigger(f,"appended")},function(){h._trigger(f,"appendfail")});if(f){if(h.isFolder(f)){f=f.first();var e=h._ensure(f,true);var g=h._insert(e,null,null,d.itemData,h.getPath(f).add(f),h.getLevel(f)+1);if(g.length){f.addClass("aciTreeFolder").removeClass("aciTreeFolderMaybe");g.each(function(){h._trigger(b(this),"added")})}else{if(!h.childrens(f).length){e.remove()}}h._success(f,d);return g}else{h._fail(f,d);return b([])}}else{var e=h._ensure(h._instance.jQuery,true);var g=h._insert(e,null,null,d.itemData,null,0);if(g.length){h._animate(null,true,!h._instance.options.animateRoot||d.unanimated);g.each(function(){h._trigger(b(this),"added")})}else{if(!h.childrens().length){e.remove()}}h._success(f,d);return g}},before:function(e,d){var g=this;d=g._options(d,function(){g._trigger(e,"before")},function(){g._trigger(e,"beforefail")});if(g.isItem(e)){e=e.first();var f=g._insert(null,e,null,d.itemData,g.getPath(e),g.getLevel(e));f.each(function(){g._trigger(b(this),"added")});g._success(e,d);return f}else{g._fail(e,d);return b([])}},after:function(e,d){var g=this;d=g._options(d,function(){g._trigger(e,"after")},function(){g._trigger(e,"afterfail")});if(g.isItem(e)){e=e.first();var f=g._insert(null,null,e,d.itemData,g.getPath(e),g.getLevel(e));f.each(function(){g._trigger(b(this),"added")});g._success(e,d);return f}else{g._fail(e,d);return b([])}},itemFrom:function(d){if(d){var e=b(d).first();if(e.hasClass("aciTree")){return b([])}else{if(e.hasClass("aciTreeLi")){return e}else{return e.parents("li.aciTreeLi:first")}}}return b([])},childrens:function(e,d){if(!e){e=this._instance.jQuery}return e.first().find(d?">ul.aciTreeUl li.aciTreeLi":">ul.aciTreeUl>li.aciTreeLi")},folders:function(d,f){var e=d.filter("li.aciTreeFolder,li.aciTreeFolderMaybe");if(typeof f!="undefined"){e=f?e.filter(".aciTreeOpen"):e.not(".aciTreeOpen")}return e},files:function(d){return d.filter("li.aciTreeFile")},isFolder:function(d){return d&&(d.first().hasClass("aciTreeFolder")||d.first().hasClass("aciTreeFolderMaybe"))},isFile:function(d){return d&&d.first().hasClass("aciTreeFile")},wasLoad:function(d){if(!d){return this._instance.jQuery.find(">ul.aciTreeUl").length>0}if(this.isFolder(d)){return d.first().find(">ul.aciTreeUl").length>0}return true},setFolder:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"folderset")});if(f.isItem(e)){if(f.isFile(e)){e.first().removeClass("aciTreeFile").addClass("aciTreeFolder")}f._success(e,d)}else{f._fail(e,d)}},setFile:function(e,d){var f=this;d=f._options(d,function(){f._trigger(e,"fileset")});if(f.isItem(e)){if(f.isFolder(e)){if(f.wasLoad(e)){f.unload(e,{success:function(){e.first().removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile");f._success(e,d)},fail:d.fail,unanimated:d.unanimated})}else{e.first().removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile");f._success(e,d)}}else{f._success(e,d)}}else{f._fail(e,d)}},setIcon:function(f,e){if(this.isItem(f)){f=f.first();var d=f.find(">div.aciTreeItem");var g=d.find(">div.aciTreeIcon");if(g.length){if(e){if(e instanceof Array){g.attr("class","aciTreeIcon "+e[0]).css("background-position",e[1]+"px "+e[2]+"px")}else{g.attr("class","aciTreeIcon "+e)}}else{g.remove()}}else{if(e){if(e instanceof Array){d.prepend('<div class="aciTreeIcon '+e[0]+'" style="background-position:'+e[1]+"px "+e[2]+'px"></div>')}else{d.prepend('<div class="aciTreeIcon '+e+'"></div>')}}}return true}return false},setItem:function(h,g){if(this.isItem(h)){h=h.first();var d=this.getText(h);var e=h.find(">div.aciTreeItem");var f=e.find(">div.aciTreeIcon").detach();e.html(g).prepend(f);this._trigger(h,"itemset",{oldText:d});return true}return false},isOpen:function(d){return d&&d.first().hasClass("aciTreeOpen")},isClosed:function(d){return !this.isOpen(d)},haveChildrens:function(d){return this.childrens(d).length>0},haveSiblings:function(d){return d&&(d.first().siblings("li.aciTreeLi:first").length>0)},havePrev:function(d){return this.getPrev(d).length>0},haveNext:function(d){return this.getNext(d).length>0},siblings:function(d){return d?d.first().siblings("li.aciTreeLi"):b([])},getPrev:function(d){return d?d.first().prev("li.aciTreeLi"):b([])},getNext:function(d){return d?d.first().next("li.aciTreeLi"):b([])},getLevel:function(d){var e=-1;if(d){d=d.first();while(d.hasClass("aciTreeLi")){d=d.parent().parent();e++}}return e},getId:function(d){return d?d.first().data("id"+this._instance.nameSpace):null},setId:function(e,f){if(f&&this.isItem(e)){var d=this.getId(e);e.first().data("id"+this._instance.nameSpace,f);this._trigger(e,"idset",{oldId:d});return true}return false},getIndex:function(e){if(this.isItem(e)){var d=e.parent();return d.find(">li.aciTreeLi").index(e.first())}return null},getText:function(d){return(d?d.first().find(">div.aciTreeItem").text():null)},isItem:function(d){return d&&d.first().hasClass("aciTreeLi")},_animate:function(g,h,f,i){if(!g){g=this._instance.jQuery}if(!f){var e=h?this._instance.options.show:this._instance.options.hide;if(e){var d=g.first().find(">ul.aciTreeUl");if(d.length){d.stop(true,true).animate(e.props,{duration:e.duration,easing:e.easing,complete:i})}else{if(i){i()}}return}}g.first().find(">ul.aciTreeUl").stop(true,true).toggle(h);if(i){i()}},getFirst:function(d){if(!d){d=this._instance.jQuery}return d.first().find(">ul.aciTreeUl>li.aciTreeLi:first")},getLast:function(d){if(!d){d=this._instance.jQuery}return d.first().find(">ul.aciTreeUl>li.aciTreeLi:last")},isBusy:function(d){if(d){return d.first().hasClass("aciTreeLoad")}else{return !this._instance._loadQueue.empty()}},_loading:function(d,e){if(d){d.toggleClass("aciTreeLoad",e)}else{if(e){this._loader(e)}}},_loader:function(d){var e=this;if(d||e.isBusy()){if(!e._instance._loaderInterval){e._instance._loaderInterval=setInterval(function(){e._loader()},e._instance.options.loaderDelay)}e._instance.jQuery.toggleClass("aciTreeLoad",true);clearTimeout(e._instance._loaderHide);e._instance._loaderHide=setTimeout(function(){e._instance.jQuery.toggleClass("aciTreeLoad",false)},e._instance.options.loaderDelay*2)}},isChildren:function(e,d){if(this.isItem(d)){return(this.childrens(e,true).filter(d.first()).length==1)}return false},isImmediateChildren:function(f,e){if(this.isItem(e)){var d=this.getParent(e);if(d.length){return f&&(d.get(0)==f.get(0))}else{return !f}}return false},sameParent:function(f,d){if(this.isItem(f)&&this.isItem(d)){var g=this.getParent(f);var e=this.getParent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},sameTopParent:function(f,d){if(this.isItem(f)&&this.isItem(d)){var g=this.getTopParent(f);var e=this.getTopParent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},destroy:function(){var e=this;if(e.wasInit()){if(e.isLocked()){e._trigger(null,"locked");return false}e._instance.locked=true;e._instance.jQuery.toggleClass("aciTreeLoad",true);e._instance._branchQueue.destroy();e._instance._loadQueue.destroy();var d=e._super;e.unload(null,{success:function(){clearTimeout(e._instance._loaderHide);clearInterval(e._instance._loaderInterval);e._destroy();e._instance.jQuery.off(e._instance.nameSpace,"div.aciTreeButton");e._instance.jQuery.toggleClass("aciTreeLoad",false);e._instance.locked=false;d.apply(e);e._trigger(null,"destroyed")},fail:function(){e._instance.jQuery.toggleClass("aciTreeLoad",false);e._instance.locked=false;e._trigger(null,"destroyfail")}});return true}e._trigger(null,"notinit");return false},_destroy:function(){}};aciPluginClass.plugins.aciTree=aciPluginClass.aciPluginUi.extend(c);aciPluginClass.publish("aciTree",a)})(jQuery);

// utils
(function(b){var a={__extend:function(){this._instance._branchQueue=new this._queue(null,true,this._instance.options.queueDelay);this._super()},update:function(d,c){var f=this;c=f._options(c);if(f.isItem(d)){if(c.itemData.props&&(c.itemData.props.isFolder||(c.itemData.props.isFolder===null))){var e=function(){f.setId(d,c.itemData.id);f.setItem(d,c.itemData.item);if(c.itemData.props){f.setIcon(d,c.itemData.props.icon)}d=d.first();d.removeClass("aciTreeFolder aciTreeFolderMaybe").addClass((c.itemData.props.isFolder||(c.itemData.items&&c.itemData.items.length))?"aciTreeFolder":"aciTreeFolderMaybe");if(c.itemData.items){if(f.wasLoad(d)){f.unload(d,{success:function(){f.initFrom(d,{success:c.success,fail:c.fail,itemData:c.itemData.items})},fail:c.fail,unanimated:c.unanimated})}else{f.initFrom(d,{success:c.success,fail:c.fail,itemData:c.itemData.items})}}else{f._success(d,c)}};f.setFolder(d,{success:e,fail:c.fail})}else{var e=function(){f.setId(d,c.itemData.id);f.setItem(d,c.itemData.item);if(c.itemData.props){f.setIcon(d,c.itemData.props.icon)}};f.setFile(d,{success:e,fail:c.fail})}}else{f._fail(d,c)}},branch:function(c,g,d){var f=this;var e=function(i,k,h){var j=h?f.getNext(i):f.getFirst(i);if(j.length){if(f.isFolder(j)){if(f.wasLoad(j)){f._instance._branchQueue.push(function(){k(f,j);e(j,k);e(j,k,true)}).run()}else{if(d){f._instance._branchQueue.push(function(l){f.ajaxLoad(j,{success:function(){k(f,j);e(j,k);e(j,k,true);l()},fail:function(){e(j,k,true);l()}})},true).run()}else{f._instance._branchQueue.push(function(){k(f,j);e(j,k,true)}).run()}}}else{f._instance._branchQueue.push(function(){k(f,j);e(j,k,true)}).run()}}};e(c,g)},isBusy:function(c){if(c){return this._super(c)}else{return this._super(c)||!this._instance._branchQueue.empty()}},swap:function(d,c){if(this.isItem(d)&&this.isItem(c)&&!this.isChildren(d,c)&&!this.isChildren(c,d)&&(d.get(0)!=c.get(0))){d=d.first();c=c.first();var g=this.getPrev(d);if(g.length){if(c.get(0)==g.get(0)){c.before(d)}else{d.insertAfter(c);c.insertAfter(g)}}else{var f=this.getNext(d);if(f.length){if(c.get(0)==f.get(0)){c.after(d)}else{d.insertAfter(c);c.insertBefore(f)}}else{var e=d.parent();d.insertAfter(c);e.append(c)}}this._trigger(null,"swapped",{item1:d,item2:c});return true}return false},moveUp:function(e){if(this.isItem(e)){var d=this.getPrev(e);var c=this.getIndex(e);if(d.length){d.before(e.first())}this._trigger(e,"movedup",{oldIndex:c});return true}return false},moveDown:function(e){if(this.isItem(e)){var d=this.getNext(e);var c=this.getIndex(e);if(d.length){d.after(e.first())}this._trigger(e,"moveddown",{oldIndex:c});return true}return false},moveFirst:function(e){if(this.isItem(e)){var d=this.getParent(e);if(!d.length){d=this._instance.jQuery}var c=this.getIndex(e);d.find(">ul.aciTreeUl").prepend(e.first());this._trigger(e,"movedfirst",{oldIndex:c});return true}return false},moveLast:function(e){if(this.isItem(e)){var d=this.getParent(e);if(!d.length){d=this._instance.jQuery}var c=this.getIndex(e);d.find(">ul.aciTreeUl").append(e.first());this._trigger(e,"movedlast",{oldIndex:c});return true}return false},_search:function(k,g){var j=this.childrens(k);var l,c,e,n,h=false;for(var f=0,m=j.length;f<m;f++){l=j.eq(f);c=l.data("id"+this._instance.nameSpace);if(c){e=c.length;if(e){if(c==g.substr(0,e)){n=l;h=g.length==e;break}}}}if(n){if(!h){var d=this._search(n,g);if(d){return d}}return{item:n,exact:h}}else{return null}},searchId:function(c,i,h,k){var f=this;k=f._options(k);if(c){if(i){if(h){var d=function(l){var m=f._search(l,c);if(m){if(m.exact){f._success(m.item,k)}else{if(f.wasLoad(m.item)){f._fail(l,k)}else{f.ajaxLoad(m.item,{success:function(){d(m.item)},fail:k.fail})}}}else{f._fail(l,k)}};d();return b([])}else{var j=f._search(null,c);if(j&&j.exact){f._success(j,k);return j.item}}}else{var g=[];var e="id"+f._instance.nameSpace;f._instance.jQuery.find("li.aciTreeLi").each(function(){if(b(this).data(e)==c){g[g.length]=this}});if(g.length){var j=b(g);f._success(j,k,j);return j}}}f._fail(null,k);return b([])}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a)})(jQuery);

// selectable
(function(b){var a={selectable:true,textSelection:false,callbacks:{selected:null}};var c={__extend:function(){this._instance.focus=false;this._super()},_initSelectable:function(){var d=this;if(typeof d._instance.jQuery.attr("tabindex")=="undefined"){d._instance.jQuery.attr("tabindex",-1)}d._instance.jQuery.bind("focus"+d._private.nameSpace,function(){d._instance.focus=true}).bind("blur"+d._private.nameSpace,function(){d._instance.focus=false}).bind("keydown"+d._private.nameSpace,function(h){if(!d._instance.focus){return}var g=d.getSelected();var f=b([]);switch(h.which){case 38:f=g.length?d._prevOpen(g):d.getFirst();break;case 40:f=g.length?d._nextOpen(g):d.getFirst();break;case 37:if(g.length){if(d.isOpen(g)){d.close(g,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{f=d.getParent(g)}}else{f=d.getFirst()}break;case 39:if(g.length){if(d.isFolder(g)&&d.isClosed(g)){d.open(g,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{f=d.getFirst(g)}}else{f=d.getFirst()}break;case 33:f=g.length?d._prevPage(g):d.getFirst();break;case 34:f=g.length?d._nextPage(g):d.getFirst();break;case 36:f=d.getFirst();break;case 35:f=d._lastOpen();break;case 13:if(g.length&&d.isFolder(g)&&d.isClosed(g)){d.open(g,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 27:if(g.length&&d.isOpen(g)){d.close(g,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 32:if(g.length&&d.isFolder(g)){d.toggle(g,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break}if(f.length&&(f.get(0)!=g.get(0))){d._selected(d,f,true);return false}});d._instance.jQuery.on("click"+d._private.nameSpace,"div.aciTreeItem",function(g){var f=b(g.target).parent();d._selected(d,f,true)}).on("dblclick"+d._private.nameSpace,"div.aciTreeItem",function(g){var f=b(g.target).parent();if(d.isFolder(f)){d.toggle(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}})},_init:function(){if(this._instance.options.selectable){this._initSelectable()}this._super()},_item:function(e,f,d,g){if(!this._instance.options.textSelection){this._selectable(f.find(">div.aciTreeItem"))}this._super(e,f,d,g)},_selectable:function(d,e){if(e){d.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","-o-user-select":"text","user-select":"text"}).attr({unselectable:null,onselectstart:null}).unbind("selectstart"+this._private.nameSpace)}else{d.css({"-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).attr({unselectable:"on",onselectstart:"return false"}).bind("selectstart"+this._private.nameSpace,function(){return true})}},_lastOpen:function(d){var f=this;var e=function(h){var g=f.getLast(h);if(f.isOpen(g)){return e(g)}else{return g}};if(!d){d=f.getLast()}if(f.isOpen(d)){return e(d)}else{return d}},_prevOpen:function(f){var e=this.getPrev(f);if(e.length){return this._lastOpen(e)}else{var d=this.getParent(f);return d.length?d:f}},_nextOpen:function(e){var g=this;var f=function(j){var i=g.getParent(j);if(i.length){var h=g.getNext(i);if(h.length){return h}else{return f(i)}}return null};if(g.isOpen(e)){return g.getFirst(e)}else{var d=g.getNext(e);if(d.length){return d}else{d=f(e);return d?d:e}}},_itemHeight:function(e){var d=e.first().find(">div.aciTreeItem");return d.outerHeight(true)},_prevPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._prevOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_nextPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._nextOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_selected:function(d,e,f){if(this._instance.options.callbacks&&this._instance.options.callbacks.selected){this._instance.options.callbacks.selected(d,e,f);return}this.select(e,f);if(f){this.setVisible(e)}},select:function(e,f){var g=this;var d=g._instance.jQuery.find("li.aciTreeSelected");if(e&&f){d=d.not(e)}d.removeClass("aciTreeSelected").each(function(){g._trigger(b(this),"unselected")});if(g.isItem(e)&&f){e.first().addClass("aciTreeSelected");g._trigger(e,"selected")}},getSelected:function(){return this._instance.jQuery.find("li.aciTreeSelected:first")},isSelected:function(d){return d&&d.first().hasClass("aciTreeSelected")},option:function(d,e){var f=this;if((d=="selectable")&&(e!=f._instance.options.selectable)){if(e){f._initSelectable()}else{f._doneSelectable()}}if((d=="textSelection")&&(e!=f._instance.options.textSelection)){if(e){f._instance.jQuery.find("div.aciTreeItem").each(function(){f._selectable(b(this),true)})}else{f._instance.jQuery.find("div.aciTreeItem").each(function(){f._selectable(b(this))})}}f._super(d,e)},_doneSelectable:function(){var d=this.getSelected();if(d.length){this._selected(this,d,false)}this._instance.focus=false;this._instance.jQuery.off("click"+this._private.nameSpace+" dblclick"+this._private.nameSpace,"div.aciTreeItem");this._instance.jQuery.unbind(this._private.nameSpace)},_destroy:function(){var d=this;d._doneSelectable();d._instance.jQuery.find("div.aciTreeItem").each(function(){d._selectable(b(this),true)});this._super()}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeSelectable");aciPluginClass.defaults("aciTree",a)})(jQuery);
