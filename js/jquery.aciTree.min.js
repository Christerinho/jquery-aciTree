
/*
 * aciTree jQuery Plugin v1.0
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library http://jquery.com
 *
 * Date: Mon Feb 04 21:15 2013 +0200
 */

(function(a){a.aciTree={nameSpace:".aciTree"};a.fn.aciTree=function(c,e,f){var b=null;for(var d=0;d<this.length;d++){b=a(this[d])._aciTree(c,e,f);if(!(b instanceof jQuery)){return b}}return this};a.fn.aciTree.defaults={json:null,root:null,expand:false,collapse:false,empty:false,show:{props:{height:"show",marginTop:"show",marginBottom:"show",paddingTop:"show",paddingBottom:"show"},duration:"medium",easing:"linear"},hide:{props:{height:"hide",marginTop:"hide",marginBottom:"hide",paddingTop:"hide",paddingBottom:"hide"},duration:"medium",easing:"linear"},animateRoot:true,autoInit:true,callbacks:{beforeInit:null,afterInit:null,item:null}};a.fn._aciTree=function(t,F,H){var l=this;var R=l.data(a.aciTree.nameSpace);if(!R&&((typeof t=="undefined")||(typeof t=="object"))){R={options:a.extend({},a.fn.aciTree.defaults,t),wasInit:false};l.data(a.aciTree.nameSpace,R)}var N=function(){if(!R||R.wasInit){return}R.wasInit=true;if(R.options.callbacks&&R.options.callbacks.beforeInit){R.options.callbacks.beforeInit(l)}l.on("click"+a.aciTree.nameSpace,".aciTreeButton",function(Z){var Y=a(Z.target).parent();w(Y)});if(R.options.root){V(null,R.options.root)}else{M()}if(R.options.callbacks&&R.options.callbacks.afterInit){R.options.callbacks.afterInit(l)}};var A=function(Z,Y,aa){if(R.options.callbacks&&R.options.callbacks.item){R.options.callbacks.item(l,Z,Y,aa);return}Z.find(".aciTreeItem").html(Y.item)};var G=function(Z){var aa=[];if(Z){var Y=Z.parent().parent();if(Y.hasClass("aciTreeLi")){aa=aa.concat(G(Y),Y.get(0))}}return aa};var m=function(Y){return a(G(Y))};var i=function(Z){if(Z){var Y=Z.parent().parent();return Y.hasClass("aciTreeLi")}return false};var J=function(Y){return Y?Y.parent().parent().filter(".aciTreeLi"):null};var n=function(ag,af,Y,ad){if(af&&af.length){var ae=a('<ul class="aciTreeUl" style="display:none"></ul>');if((af.length==1)&&(Y==0)){ae.addClass("aciSingle")}ag.append(ae);var Z,ah,ac;var ai=m(ag).add(ag);for(var ab in af){Z=af[ab];ah=a('<li class="aciTreeLi"></li>').data("id"+a.aciTree.nameSpace,Z.id);ac="";for(var aa=0;aa<Y;aa++){ac+='<span class="aciTreeSpace '+(D(ai.eq(aa))?" aciTreeBranch":"")+'"></span>'}ac+='<span class="aciTreeButton"><span></span></span>';if(Z.props&&Z.props.icon){if(Z.props.icon instanceof Array){ac+='<span class="aciTreeIcon '+Z.props.icon[0]+'" style="background-position:'+Z.props.icon[1]+"px "+Z.props.icon[2]+'px"></span>'}else{ac+='<span class="aciTreeIcon '+Z.props.icon+'"></span>'}}ac+='<span class="aciTreeItem"></span>';ah.append(ac);ae.append(ah);if(Z.props&&(Z.props.isFolder||(Z.props.isFolder===null))){ah.addClass((Z.props.isFolder||(Z.items&&Z.items.length))?"aciTreeFolder":"aciTreeFolderMaybe");n(ah,Z.items,Y+1,Z.props.open);if(Z.props.open){C(ah)}}else{ah.addClass("aciTreeFile")}A(ah,Z,Y)}if(ad){o(ae,true)}}};var o=function(Z,Y,ab){var aa=Y?R.options.show:R.options.hide;Z.animate(aa.props,{duration:aa.duration,easing:aa.easing,complete:ab})};var r=function(ad,ae,Z,aa,ag,Y){var af=a('<li class="aciTreeLi"></li>').data("id"+a.aciTree.nameSpace,aa.id);var ac="";for(var ab=0;ab<Y;ab++){ac+='<span class="aciTreeSpace '+(D(ag.eq(ab))?" aciTreeBranch":"")+'"></span>'}ac+='<span class="aciTreeButton"><span></span></span>';if(aa.props&&aa.props.icon){if(aa.props.icon instanceof Array){ac+='<span class="aciTreeIcon '+aa.props.icon[0]+'" style="background-position:'+aa.props.icon[1]+"px "+aa.props.icon[2]+'px"></span>'}else{ac+='<span class="aciTreeIcon '+aa.props.icon+'"></span>'}}ac+='<span class="aciTreeItem"></span>';af.append(ac);if(ad){ad.append(af)}else{if(ae){ae.before(af)}else{if(Z){Z.after(af)}}}if(aa.props&&(aa.props.isFolder||(aa.props.isFolder===null))){af.addClass((aa.props.isFolder||(aa.items&&aa.items.length))?"aciTreeFolder":"aciTreeFolderMaybe")}else{af.addClass("aciTreeFile")}A(af,aa,Y);return af};var h=function(ad,ae,Z,aa,ag,Y){if(aa instanceof Array){var ac=[];for(var ab in aa){ac[ac.length]=r(ad,ae,Z,aa[ab],ag,Y).get(0)}if(ad){if(ac.length){s(d(a(ac[0])))}}else{if(ae){}else{if(Z){s(Z)}}}return a(ac)}var af=r(ad,ae,Z,aa,ag,Y);if(ad){s(d(af))}else{if(ae){}else{if(Z){s(Z)}}}return af};var E=function(aa,Y){if(!aa){var Z=l.find(">.aciTreeUl");if(!Z.length){Z=a('<ul class="aciTreeUl"></ul>');l.append(Z)}return h(Z,null,null,Y,null,0)}else{if(L(aa)){var Z=aa.find(">.aciTreeUl");if(!Z.length){Z=a('<ul class="aciTreeUl" style="display:none"></ul>');aa.append(Z)}var ab=h(Z,null,null,Y,m(aa).add(aa),e(aa)+1);if(ab.length){aa.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder")}return ab}}};var B=function(Z,Y){return h(null,Z,null,Y,m(Z),e(Z))};var S=function(Z,Y){return h(null,null,Z,Y,m(Z),e(Z))};var U=function(Y){var Z=a(Y).eq(0);if(Z.hasClass("aciTree")){return null}else{if(Z.hasClass("aciTreeLi")){return Z}else{return Z.parents(".aciTreeLi:first")}}};var Q=function(Y){if(!Y){Y=l}return Y.find(">.aciTreeUl>.aciTreeLi")};var w=function(Y){if(L(Y)){if(Y.hasClass("aciTreeOpen")){Y.removeClass("aciTreeOpen");o(Y.find(">.aciTreeUl").stop(true),false,function(){if(R.options.empty){a(this).remove()}});P(Y,R.options.collapse)}else{Y.addClass("aciTreeOpen");if(v(Y)){o(Y.find(">.aciTreeUl").stop(true),true);p(Y,R.options.expand)}else{M(Y,function(){o(Y.find(">.aciTreeUl").stop(true),true);p(Y,R.options.expand)})}}}};var L=function(Y){return Y&&(Y.hasClass("aciTreeFolder")||Y.hasClass("aciTreeFolderMaybe"))};var X=function(Y){return Y&&Y.hasClass("aciTreeFile")};var v=function(Y){if(!Y){return l.find(">.aciTreeUl").length>0}if(L(Y)){return Y.find(">.aciTreeUl").length>0}return true};var b=function(Y){if(Y){Y.find(">.aciTreeUl").remove();f(Y)}else{l.html("")}};var s=function(Z){if(L(Z)){var aa=e(Z);var Y=D(Z);Z.find(".aciTreeLi").each(function(){var ab=a(this).find(">.aciTreeSpace").eq(aa);if(Y){if(!ab.hasClass("aciTreeBranch")){ab.addClass("aciTreeBranch")}}else{ab.removeClass("aciTreeBranch")}})}};var u=function(aa){if(aa){var Y=J(aa);var Z=d(aa);aa.remove();if(Y&&!Q(Y).length){b(Y)}s(Z)}else{l.html("")}};var y=function(Y){if(X(Y)){Y.removeClass("aciTreeFile").addClass("aciTreeFolderMaybe")}};var O=function(Y){if(L(Y)){b(Y);Y.removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile")}};var I=function(Z,Y){var aa=Z.find(">.aciTreeIcon");if(aa.length){if(Y){if(Y instanceof Array){aa.attr("class","aciTreeIcon").addClass(Y[0]).css("background-position",Y[1]+"px "+Y[2]+"px")}else{aa.attr("class","aciTreeIcon").addClass(Y)}}else{aa.remove()}}else{if(Y){if(Y instanceof Array){Z.find(">.aciTreeButton").after('<span class="aciTreeIcon '+Y[0]+'" style="background-position:'+Y[1]+"px "+Y[2]+'px"></span>')}else{Z.find(">.aciTreeButton").after('<span class="aciTreeIcon '+Y+'"></span>')}}}};var p=function(Z,Y){if(Y){var aa=Q(Z);aa.each(function(){C(a(this),true)})}};var P=function(Z,Y){if(Y){var aa=Q(Z);aa.each(function(){f(a(this),true)})}};var C=function(Z,Y){if(L(Z)){if(!Z.hasClass("aciTreeOpen")){Z.addClass("aciTreeOpen");if(v(Z)){o(Z.find(">.aciTreeUl").stop(true),true);p(Z,Y)}else{M(Z,function(){o(Z.find(">.aciTreeUl").stop(true),true);p(Z,Y)})}}}};var f=function(Z,Y){if(L(Z)){if(Z.hasClass("aciTreeOpen")){Z.removeClass("aciTreeOpen");o(Z.find(">.aciTreeUl").stop(true),false,function(){if(R.options.empty){a(this).remove()}});P(Z,Y)}}};var W=function(Y){if(!Y){Y=l}return Y.find(">.aciTreeUl").length>0};var k=function(Y){return Y&&(Y.parent().find(">.aciTreeLi").length>1)};var g=function(Y){return Y&&(Y.prev(".aciTreeLi").length>0)};var D=function(Y){return Y&&(Y.next(".aciTreeLi").length>0)};var K=function(Y){return Y?Y.parent().find(">.aciTreeLi").not(Y):a([])};var d=function(Y){return Y?Y.prev(".aciTreeLi"):a([])};var z=function(Y){return Y?Y.next(".aciTreeLi"):a([])};var x=function(Z){if(Z&&Z.hasClass("aciTreeLi")){var Y=Z.parent().parent();return 1+x(Y)}return null};var e=function(Y){var Z=x(Y);if(Z!==null){return Z-1}return null};var T=function(Y){return Y?Y.data("id"+a.aciTree.nameSpace):null};var c=function(Y){return(Y?Y.find(">.aciTreeItem").text():null)};var q=function(Z){if(Z){var Y="id"+a.aciTree.nameSpace;l.find(".aciTreeLi").each(function(){if(a(this).data(Y)==Z){return a(this)}})}return null};var V=function(Z,Y){if(Z){if(!v(Z)){var aa=e(Z);if(Y.length){Z.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder");n(Z,Y,aa+1,false)}else{O(Z)}Z.find(">.aciTreeButton").removeClass("aciTreeLoad")}}else{if(!v()){l.html("");n(l,Y,0,R.options.animateRoot);if(!R.options.animateRoot){l.find(">.aciTreeUl").show()}l.removeClass("aciTreeLoad")}}};var M=function(Y,aa){if(Y){if(!v(Y)){Y.find(">.aciTreeButton").addClass("aciTreeLoad");var Z=e(Y);a.get(R.options.json+T(Y),null,function(ab){if(ab.length){Y.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder");n(Y,ab,Z+1,false);if(aa){aa()}}else{O(Y)}Y.find(">.aciTreeButton").removeClass("aciTreeLoad")},"json")}}else{if(!v()){l.addClass("aciTreeLoad");a.get(R.options.json,null,function(ab){l.html("");n(l,ab,0,R.options.animateRoot);if(!R.options.animateRoot){l.find(">.aciTreeUl").show()}l.removeClass("aciTreeLoad")},"json")}}};var j=function(){if((typeof t=="undefined")||(typeof t=="object")){if(R.options.autoInit){N()}}else{if(typeof t=="string"){switch(t){case"init":N();break;case"api":return{itemFrom:U,getId:T,getText:c,getLevel:e,byId:q,isFile:X,isFolder:L,wasLoad:v,empty:b,remove:u,setFolder:y,setFile:O,setIcon:I,haveParent:i,getParent:J,getPath:m,addAfter:S,addBefore:B,addChildren:E,toggle:w,doOpen:C,doClose:f,haveSiblings:k,havePrev:g,haveNext:D,haveChildrens:W,siblings:K,getPrev:d,getNext:z,childrens:Q,doInit:V,doLoad:M};case"option":if(R){R.options[F]=H;l.data(a.aciTree.nameSpace,R)}break;case"options":return R?R.options:null;case"destroy":if(R){b();l.off(a.aciTree.nameSpace,".aciTreeButton");l.data(a.aciTree.nameSpace,null)}break}}}return l};return j()}})(jQuery);
