
/*
 * aciTree jQuery Plugin v3.0.0-rc.6
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.7.1 http://jquery.com
 * + aciPlugin >= v1.1.1 https://github.com/dragosu/jquery-aciPlugin
 *
 * Date: Apr Mon 17 21:40 2013 +0200
 */

// core
(function(b){var a={jsonUrl:null,rootData:null,threads:4,queueDelay:40,loaderDelay:500,expand:false,collapse:false,unique:false,empty:false,show:{props:{height:"show"},duration:"medium",easing:"linear"},animateRoot:true,hide:{props:{height:"hide"},duration:"medium",easing:"linear"},view:{duration:"medium",easing:"linear"},callbacks:{item:null}};var c={__extend:function(){b.extend(this._instance,{locked:false});b.extend(this._private,{loadQueue:new this._queue(this._instance.options.threads,false,this._instance.options.queueDelay).context(this),loaderHide:null,loaderInterval:null,delayBusy:0})},init:function(e){var h=this;e=this._options(e);if(this.wasInit()){this._trigger(null,"wasinit",e);this._fail(null,e);return}if(this.isLocked()){this._trigger(null,"locked",e);this._fail(null,e);return}if(!this._trigger(null,"beforeinit",e)){this._trigger(null,"initfail",e);this._fail(null,e);return}this._instance.locked=true;this._instance.jQuery.bind("mousedown"+this._instance.nameSpace,function(j){var i=b(j.target);if(i.is(".aciTreeButton,.aciTreeLoad,.aciTreeEntry,.aciTreeIcon")){h._instance.jQuery.focus();j.preventDefault()}}).on("click"+this._instance.nameSpace,".aciTreeButton",function(j){var i=h.itemFrom(j.target);if(!h.isBusy(i)){h.toggle(i,{collapse:h._instance.options.collapse,expand:h._instance.options.expand,unique:h._instance.options.unique})}}).on("mouseenter"+this._instance.nameSpace+" mouseleave"+this._instance.nameSpace,".aciTreeButton",function(j){var i=b(j.target);if(!i.hasClass("aciTreeButton")){i=i.parents(".aciTreeButton:first")}i.toggleClass("aciTreeHover",j.type=="mouseenter")}).on("mouseenter"+this._instance.nameSpace+" mouseleave"+this._instance.nameSpace,".aciTreeLine",function(j){var i=b(j.target);if(!i.hasClass("aciTreeLine")){i=i.parents(".aciTreeLine:first")}i.toggleClass("aciTreeHover",j.type=="mouseenter")});this._initHook();var f=this._super;var g=function(){f.apply(this);this._instance.locked=false;this._trigger(null,"init",e);this._success(null,e)};var d=function(){f.apply(this);this._instance.locked=false;this._trigger(null,"initfail",e);this._fail(null,e)};if(this._instance.options.rootData){this.loadFrom(null,this._inner(e,{success:g,fail:d,itemData:this._instance.options.rootData}))}else{if(this._instance.options.jsonUrl){this.ajaxLoad(null,this._inner(e,{success:g,fail:d}))}else{g.apply(this)}}},_initHook:function(){},isLocked:function(){return this._instance.locked},_queue:function(j,l,e){var k=[];var g=[];var d=j?Math.max(j,1):1;var i=0;var f=false;var h=null;this.push=function(n,m){if(!f){k.push({callback:n,async:m})}return this};this.complete=function(n,m){if(!f){g.push({callback:n,async:m})}return this};this.destroy=function(){f=true;setTimeout(function(){g=[];k=[];i=0;f=false},e)};this.busy=function(){return i>=d};this.empty=function(){return(i==0)&&(k.length==0)&&(g.length==0)};this.context=function(m){h=m;return this},this.run=function(p){if((i>=d)||f){return}if(p){for(var o=1,n=d-i;o<n;o++){this.run()}}var m=this;setTimeout(function(){if((i>=d)||f){return}var q=k.shift();if(!q){if(k.length){setTimeout(function(){m.run()},10)}else{q=g.shift()}}if(q){if(q.async){i++;if(h){q.callback.call(h,function(){i--;m.run()})}else{q.callback(function(){i--;m.run()})}}else{i++;if(h){q.callback.apply(h)}else{q.callback()}i--;m.run()}}},l?5:e)}},_options:function(f,h,d,g){var e=b.extend({uid:"ui",success:null,fail:null,notify:null,expand:this._instance.options.expand,collapse:this._instance.options.collapse,unique:this._instance.options.unique,unanimated:this._instance.options.unanimated,itemData:{}},f);if(h){if(f&&f.success){e.success=function(){h.apply(this,arguments);f.success.apply(this,arguments)}}else{e.success=h}}if(d){if(f&&f.fail){e.fail=function(){d.apply(this,arguments);f.fail.apply(this,arguments)}}else{e.fail=d}}if(g){if(f&&f.notify){e.notify=function(){g.apply(this,arguments);f.notify.apply(this,arguments)}}else{if(!e.notify&&f&&f.success){e.notify=function(){g.apply(this,arguments);f.success.apply(this,arguments)}}else{e.notify=g}}}else{if(!e.notify&&f&&f.success){e.notify=f.success}}return e},_inner:function(d,e){return b.extend({},d,{success:null,fail:null,notify:null},e)},_trigger:function(g,d,e){var f=b.Event("acitree");if(!e){e=this._options()}this._instance.jQuery.trigger(f,[this,g?g.first():null,d,e]);return !f.isDefaultPrevented()},_success:function(e,d){if(d&&d.success){d.success.call(this,e?e.first():null,d)}},_fail:function(e,d){if(d&&d.fail){d.fail.call(this,e?e.first():null,d)}},_notify:function(e,d){if(d&&d.notify){d.notify.call(this,e?e.first():null,d)}},_delayBusy:function(d,f){if((this._private.delayBusy<10)&&this.isBusy(d)){this._private.delayBusy++;var e=this._private;setTimeout(b.proxy(function(){this._delayBusy.call(this,d,f);e.delayBusy--},this),10);return}f.apply(this)},ajaxLoad:function(e,d){if(e&&this.isBusy(e)){this._delayBusy(e,function(){this.ajaxLoad(e,d)});return}d=this._options(d,function(){this._loading(e);this._trigger(e,"loaded",d)},function(){this._loading(e);this._trigger(e,"loadfail",d)},function(){this._loading(e);this._trigger(e,"wasloaded",d)});if(!e||this.isFolder(e)){this._private.loadQueue.push(function(f){if(!this._trigger(e,"beforeload",d)){this._fail(e,d);f();return}this._loading(e,true);if(this.wasLoad(e)){this._notify(e,d);f();return}b.get(this._instance.options.jsonUrl+(e?this.getId(e):""),b.proxy(function(g){if(g&&(g instanceof Array)&&g.length){var h=function(){if(this.wasLoad(e)){this._notify(e,d);f()}else{this._createBranch(e,this._inner(d,{success:function(){this._success(e,d);f()},fail:function(){this._fail(e,d);f()},itemData:g}))}};if(!e||this.isFolder(e)){h.apply(this)}else{this.setFolder(e,this._inner(d,{success:h,fail:d.fail}))}}else{var h=function(){this._fail(e,d);f()};if(!e||this.isFile(e)){h.apply(this)}else{this.setFile(e,this._inner(d,{success:h,fail:h}))}}},this),"json").fail(function(){this._fail(e,d);f()})},true).run()}else{this._fail(e,d)}},loadFrom:function(e,d){if(e&&this.isBusy(e)){this._delayBusy(e,function(){this.loadFrom(e,d)});return}d=this._options(d,function(){this._loading(e);this._trigger(e,"loaded",d)},function(){this._loading(e);this._trigger(e,"loadfail",d)},function(){this._loading(e);this._trigger(e,"wasloaded",d)});if(!e||this.isFolder(e)){if(!this._trigger(e,"beforeload",d)){this._fail(e,d);return}this._loading(e,true);if(this.wasLoad(e)){this._notify(e,d);return}if(d.itemData&&(d.itemData instanceof Array)&&d.itemData.length){var f=function(){if(this.wasLoad(e)){this._notify(e,d)}else{this._createBranch(e,d)}};if(!e||this.isFolder(e)){f.apply(this)}else{this.setFolder(e,this._inner(d,{success:f,fail:d.fail}))}}else{if(!e||this.isFile(e)){this._fail(e,d)}else{this.setFile(e,this._inner(d,{success:d.fail,fail:d.fail}))}}}else{this._fail(e,d)}},unload:function(f,d){var h=this;d=this._options(d,function(){this._loading(f);this._trigger(f,"unloaded",d)},function(){this._loading(f);this._trigger(f,"unloadfail",d)},function(){this._loading(f);this._trigger(f,"notloaded",d)});if(!f||this.isFolder(f)){if(!this._trigger(f,"beforeunload",d)){this._fail(f,d);return}this._loading(f,true);if(!this.wasLoad(f)){this._notify(f,d);return}var e=false;var g=this.childrens(f,true);g.each(function(){var i=b(this);if(h.isFolder(i)){if(h.isOpen(i)){if(!h._trigger(i,"beforeclose",d)){e=true;return false}}if(h.wasLoad(i)){if(!h._trigger(i,"beforeunload",d)){e=true;return false}}}if(!h._trigger(i,"beforeremove",d)){e=true;return false}});if(e){this._fail(f,d);return}g.each(function(){var i=b(this);if(h.isFolder(i)){if(h.isOpen(i)){h._trigger(i,"closed",d)}if(h.wasLoad(i)){h._trigger(i,"unloaded",d)}}h._trigger(i,"removed",d)});if(f){if(this.isOpen(f)){this.close(f,this._inner(d,{success:function(){this._removeContainer(f);this._success(f,d)},fail:d.fail}))}else{this._removeContainer(f);this._success(f,d)}}else{this._animate(f,false,!this._instance.options.animateRoot||d.unanimated,function(){this._removeContainer();this._success(f,d)})}}else{this._fail(f,d)}},remove:function(f,d){d=this._options(d,function(){this._trigger(f,"removed",d)},function(){this._trigger(f,"removefail",d)});if(this.isItem(f)){if(!this._trigger(f,"beforeremove",d)){this._fail(f,d);return}if(this.isFolder(f)&&this.wasLoad(f)){this.unload(f,this._inner(d,{success:function(){this._success(f,d);this._removeItem(f)},fail:d.fail}))}else{if(this.hasSiblings(f)){this._success(f,d);this._removeItem(f)}else{var e=this.parent(f);this.unload(e.length?e:null,this._inner(d,{success:d.success,fail:d.fail}))}}}else{this._fail(f,d)}},_openChilds:function(f,e){if(e.expand){var d=new this._queue(this._instance.options.threads,true).context(this);this.folders(this.childrens(f)).each(function(){var g=b(this);d.push(function(h){this.open(g,this._inner(e,{success:h,fail:h}))},true)});d.complete(function(){this._success(f,e)}).run(true)}else{this._success(f,e)}},_openItem:function(e,d){if(!d.unanimated&&!this.isVisible(e)){d.unanimated=true}if(d.unique){this.closeOthers(e);d.unique=false}e.first().addClass("aciTreeOpen");this._updateOddEvenChilds(e);this._animate(e,true,d.unanimated,function(){this._openChilds(e,d)})},open:function(e,d){d=this._options(d,function(){if(this.isOpenPath(e)){this._updateVisible(e,true);this._updateOddEven(e)}this._trigger(e,"opened",d)},function(){this._trigger(e,"openfail",d)},function(){this._trigger(e,"wasopened",d)});if(this.isFolder(e)){if(!this._trigger(e,"beforeopen",d)){this._fail(e,d);return}if(this.isOpen(e)){d.success=d.notify;this._openChilds(e,d)}else{if(this.wasLoad(e)){this._openItem(e,d)}else{this.ajaxLoad(e,this._inner(d,{success:function(){this._openItem(e,d)},fail:d.fail}))}}}else{this._fail(e,d)}},_closeChilds:function(f,e){if(this._instance.options.empty){e.unanimated=true;this.unload(f,e)}else{if(e.collapse){var d=new this._queue(this._instance.options.threads,true).context(this);this.folders(this.childrens(f)).each(function(){var g=b(this);d.push(function(h){this.close(g,this._inner(e,{success:h,fail:h,unanimated:true}))},true)});d.complete(function(){this._success(f,e)}).run(true)}else{this._success(f,e)}}},_closeItem:function(e,d){if(!d.unanimated&&!this.isVisible(e)){d.unanimated=true}e.first().removeClass("aciTreeOpen");this._animate(e,false,d.unanimated,function(){this._closeChilds(e,d)})},close:function(e,d){d=this._options(d,function(){if(this.isOpenPath(e)){this._updateVisible(e,false);this._updateOddEven(e)}this._trigger(e,"closed",d)},function(){this._trigger(e,"closefail",d)},function(){this._trigger(e,"wasclosed",d)});if(this.isFolder(e)){if(!this._trigger(e,"beforeclose",d)){this._fail(e,d);return}if(this.isOpen(e)){this._closeItem(e,d)}else{if(this.wasLoad(e)){d.success=d.notify;this._closeChilds(e,d)}else{this._notify(e,d)}}}else{this._fail(e,d)}},_updateVisible:function(d,f){var g=this;var e=this.childrens(d);if(f){this.folders(e,true).each(function(){var h=b(this);if(!h.hasClass("aciTreeVisible")){g._updateVisible(h,true)}});e.addClass("aciTreeVisible")}else{this.folders(e,true).each(function(){var h=b(this);if(h.hasClass("aciTreeVisible")){g._updateVisible(h,false)}});e.removeClass("aciTreeVisible")}},closeOthers:function(g,f){f=this._options(f);if(this.isItem(g)){var d=new this._queue(this._instance.options.threads,true).context(this);var e=g.first().add(this.path(g)).add(this.childrens(g,true));this.folders(this.childrens(null,true),true).not(e).each(function(){var h=b(this);d.push(function(i){this.close(h,this._inner(f,{success:i,fail:i}))},true)});d.complete(function(){this._success(g,f)}).run(true)}else{this._fail(g,f)}},toggle:function(e,d){d=this._options(d,function(){this._trigger(e,"toggled",d)},function(){this._trigger(e,"togglefail",d)});if(this.isFolder(e)){if(!this._trigger(e,"beforetoggle",d)){this._fail(e,d);return}if(this.isOpen(e)){this.close(e,d)}else{this.open(e,d)}}else{this._fail(e,d)}},path:function(e,d){if(e){var f=e.first().parentsUntil(this._instance.jQuery,".aciTreeLi");return d?f:b(f.get().reverse())}return b([])},isVisible:function(g){if(this.isOpenPath(g)){var f=this._instance.jQuery.get(0).getBoundingClientRect();var e=g.first().children(".aciTreeLine").find(".aciTreeItem");var h=e.get(0).getBoundingClientRect();var d=e.outerHeight(true);if((h.bottom-d<f.top)||(h.top+d>f.bottom)||(h.right<f.left)||(h.left>f.right)){return false}return true}return false},openPath:function(f,e){e=this._options(e);if(this.isItem(f)){var d=new this._queue(null,true).context(this);this.folders(this.path(f),false).each(function(){var g=b(this);d.push(function(h){this.open(g,this._inner(e,{success:h,fail:h}))},true)});d.complete(function(){this._success(f,e)}).run()}else{this._fail(f,e)}},isOpenPath:function(d){return d&&d.hasClass("aciTreeVisible")},_speedFraction:function(f,d,g){if((g<d)&&d){var e=parseInt(f);if(isNaN(e)){switch(f){case"slow":e=600;break;case"medium":e=400;break;case"fast":e=200;break;default:return f}}return e*g/d}return f},setVisible:function(e,d){d=this._options(d,function(){this._trigger(e,"visible",d)},function(){this._trigger(e,"visiblefail",d)},function(){this._trigger(e,"wasvisible",d)});if(this.isItem(e)){if(!this._trigger(e,"beforevisible",d)){this._fail(e,d);return}if(this.isVisible(e)){this._notify(e,d);return}var f=function(){var i=this._instance.jQuery.get(0).getBoundingClientRect();var h=e.first().children(".aciTreeLine").find(".aciTreeItem");var k=h.get(0).getBoundingClientRect();var g=h.outerHeight(true);if(k.bottom-g<i.top){var j=i.top-k.bottom+g;if(!d.unanimated&&this._instance.options.view){this._instance.jQuery.stop(true).animate({scrollTop:this._instance.jQuery.scrollTop()-j},{duration:this._speedFraction(this._instance.options.view.duration,i.bottom-i.top,j),easing:this._instance.options.view.easing,complete:b.proxy(function(){this._success(e,d)},this)})}else{this._instance.jQuery.stop(true).get(0).scrollTop=this._instance.jQuery.scrollTop()-j;this._success(e,d)}}else{if(k.top+g>i.bottom){var j=k.top-i.bottom+g;if(!d.unanimated&&this._instance.options.view){this._instance.jQuery.stop(true).animate({scrollTop:this._instance.jQuery.scrollTop()+j},{duration:this._speedFraction(this._instance.options.view.duration,i.bottom-i.top,j),easing:this._instance.options.view.easing,complete:b.proxy(function(){this._success(e,d)},this)})}else{this._instance.jQuery.stop(true).get(0).scrollTop=this._instance.jQuery.scrollTop()+j;this._success(e,d)}}else{this._success(e,d)}}};if(this.hasParent(e)){this.openPath(e,this._inner(d,{success:f,fail:d.fail}))}else{f.apply(this)}}else{this._fail(e,d)}},hasParent:function(d){return d&&(d.first().parent().parent(".aciTreeLi").length>0)},parent:function(d){return d?d.first().parent().parent(".aciTreeLi"):b([])},topParent:function(d){return this.path(d).eq(0)},_createBranch:function(f,e){var h=this;var d=new this._queue(this._instance.options.threads,true).context(this);var g=function(j,i){if(j){j.first().removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder")}h.append(j,h._inner(e,{success:function(n,l){var k;for(var m in l.itemData){k=l.itemData[m];if(k.childs&&(k.childs instanceof Array)&&k.childs.length){(function(p,o){d.push(function(q){g(p,o.childs);if(o.open){h.open(p)}q()},true)})(l.items.eq(m),k)}else{if(k.open){h.open(l.items.eq(m),h._inner(l))}}}},fail:e.fail,itemData:i}))};d.push(function(i){g(f,e.itemData);i()},true).complete(function(){h._success(f,e)}).run(true)},_updateFirstLast:function(e,d){if(d){d.removeClass("aciTreeFirst aciTreeLast")}this.first(e).addClass("aciTreeFirst");this.last(e).addClass("aciTreeLast")},_setOddEven:function(d,e){d.filter(":odd").removeClass(e?"aciTreeEven":"aciTreeOdd").addClass(e?"aciTreeOdd":"aciTreeEven");d.filter(":even").removeClass(e?"aciTreeOdd":"aciTreeEven").addClass(e?"aciTreeEven":"aciTreeOdd")},_updateOddEven:function(d){var h=this._instance.jQuery.find(".aciTreeVisible");var e=0;if(d){d.each(function(){var i=h.index(this);if(i!=-1){e=Math.min(i,e)}});e=Math.max(e-1,0)}var f=true;if(e>0){var g=h.eq(e);if(g.hasClass("aciTreOdd")){f=false}h=h.filter(":gt("+e+")")}this._setOddEven(h,f)},_updateOddEvenChilds:function(d){var f=d.hasClass("aciTreeOdd");var e=this.childrens(d);this._setOddEven(e,f)},_itemHook:function(e,f,d,g){if(this._instance.options.callbacks&&this._instance.options.callbacks.item){this._instance.options.callbacks.item.call(this,e,f,d,g)}},_createItem:function(d,j){var g=b('<li class="aciTreeLi aciTreeLevel'+j+'"></li>').data("itemData"+this._instance.nameSpace,b.extend({},d,{childs:d.childs&&d.childs.length}));var h='<div class="aciTreeLine">',e="";for(var f=0;f<j;f++){h+='<div class="aciTreeBranch aciTreeLevel'+f+'">';e+="</div>"}h+='<div class="aciTreeEntry"><span class="aciTreeButton"><span></span></span><span class="aciTreeItem">';if(d.icon){if(d.icon instanceof Array){h+='<span class="aciTreeIcon '+d.icon[0]+'" style="background-position:'+d.icon[1]+"px "+d.icon[2]+'px"></span>'}else{h+='<span class="aciTreeIcon '+d.icon+'"></span>'}}g.append(h+'<span class="aciTreeText">'+d.label+"</span></span></div>"+e+"</div>");if(d.isFolder||(d.isFolder===null)){g.addClass((d.isFolder||(d.childs&&d.childs.length))?"aciTreeFolder":"aciTreeFolderMaybe")}else{g.addClass("aciTreeFile")}return g},_removeItem:function(e){var d=this.parent(e);e.first().remove();this._updateFirstLast(d.length?d:null)},_createItems:function(h,k,e,f,d){if(f){var l;if(h){l=this.itemFrom(h)}else{if(k){l=this.parent(k)}else{if(e){l=this.parent(e)}}}var j=[],m;if(f instanceof Array){for(var g in f){m=this._createItem(f[g],d);this._itemHook(l,m,f[g],d);j[j.length]=m.get(0)}}else{m=this._createItem(f,d);this._itemHook(l,m,f,d);j[j.length]=m.get(0)}j=b(j);if(h){h.append(j)}else{if(k){k.first().before(j)}else{if(e){e.first().after(j)}}}return j}return b([])},_createContainer:function(e){if(!e){e=this._instance.jQuery}var d=e.first().children(".aciTreeUl");if(!d.length){d=b('<ul class="aciTreeUl" style="display:none"></ul>');e.first().append(d)}return d},_removeContainer:function(d){if(!d){d=this._instance.jQuery}d.first().children(".aciTreeUl").remove()},append:function(g,e){var i=this;e=this._options(e,function(){this._trigger(g,"appended",e)},function(){this._trigger(g,"appendfail",e)});if(g){if(this.isFolder(g)){if(!this._trigger(g,"beforeappend",e)){this._fail(g,e);return}var f=this.last(g);var d=this._createContainer(g);var h=this._createItems(d,null,null,e.itemData,this.level(g)+1);if(h.length){g.first().addClass("aciTreeFolder").removeClass("aciTreeFolderMaybe");if(f.length){f.removeClass("aciTreeLast")}else{h.first().addClass("aciTreeFirst");h.last().addClass("aciTreeLast")}if(this.isOpenPath(g)&&this.isOpen(g)){h.addClass("aciTreeVisible")}this._updateOddEven(h.first());h.each(function(){i._trigger(b(this),"added",e)})}else{if(!this.hasChildrens(g)){d.remove()}}e.items=h;this._success(g,e)}else{this._fail(g,e)}}else{if(!this._trigger(g,"beforeappend",e)){this._fail(g,e);return}var f=this.last();var d=this._createContainer();var h=this._createItems(d,null,null,e.itemData,0);if(h.length){if(f.length){f.removeClass("aciTreeLast")}else{h.first().addClass("aciTreeFirst");h.last().addClass("aciTreeLast")}h.addClass("aciTreeVisible").last().addClass("aciTreeLast");this._updateOddEven();h.each(function(){i._trigger(b(this),"added",e)});this._animate(null,true,!this._instance.options.animateRoot||e.unanimated)}else{if(!this.hasChildrens()){d.remove()}}e.items=h;this._success(g,e)}},before:function(f,d){var h=this;d=this._options(d,function(){this._trigger(f,"before",d)},function(){this._trigger(f,"beforefail",d)});if(this.isItem(f)){if(!this._trigger(f,"beforebefore",d)){this._fail(f,d);return}var e=this.prev(f);var g=this._createItems(null,f.first(),null,d.itemData,this.level(f));if(g.length){if(!e.length){f.first().removeClass("aciTreeFirst");g.first().addClass("aciTreeFirst")}if(this.isOpenPath(f)){g.addClass("aciTreeVisible")}this._updateOddEven(g.first());g.each(function(){h._trigger(b(this),"added",d)})}d.items=g;this._success(f,d)}else{this._fail(f,d)}},after:function(f,d){var h=this;d=this._options(d,function(){this._trigger(f,"after",d)},function(){this._trigger(f,"afterfail",d)});if(this.isItem(f)){if(!this._trigger(f,"beforeafter",d)){this._fail(f,d);return}var e=this.next(f);var g=this._createItems(null,null,f.first(),d.itemData,this.level(f));if(g.length){if(!e.length){f.first().removeClass("aciTreeLast");g.last().addClass("aciTreeLast")}if(this.isOpenPath(f)){g.addClass("aciTreeVisible")}this._updateOddEven(g.first());g.each(function(){h._trigger(b(this),"added",d)})}d.items=g;this._success(f,d)}else{this._fail(f,d)}},itemFrom:function(d){if(d){var e=b(d).first();if(e.get(0)==this._instance.jQuery.get(0)){return b([])}else{if(e.hasClass("aciTreeLi")){return e}else{return e.parents(".aciTreeLi:first")}}}return b([])},childrens:function(e,d){if(!e){e=this._instance.jQuery}return d?e.first().find(".aciTreeLi"):e.first().children(".aciTreeUl").children(".aciTreeLi")},visible:function(e,d){var g=this;e=e.filter(".aciTreeVisible");if(d){var f=b.grep(e.get(),function(h){return g.isVisible(b(h))});e=b(f)}return e},folders:function(d,e){if(typeof e!="undefined"){if(e){return d.filter(".aciTreeOpen")}else{return d.filter(".aciTreeFolder,.aciTreeFolderMaybe").not(".aciTreeOpen")}}return d.filter(".aciTreeFolder,.aciTreeFolderMaybe")},files:function(d){return d.filter(".aciTreeFile")},isFolder:function(d){return d&&(d.first().hasClass("aciTreeFolder")||d.first().hasClass("aciTreeFolderMaybe"))},isFile:function(d){return d&&d.first().hasClass("aciTreeFile")},wasLoad:function(d){if(!d){return this._instance.jQuery.children(".aciTreeUl").length>0}if(this.isFolder(d)){return d.first().children(".aciTreeUl").length>0}return true},setFolder:function(e,d){d=this._options(d,function(){this._trigger(e,"folderset",d)},function(){this._trigger(e,"folderfail",d)},function(){this._trigger(e,"wasfolder",d)});if(this.isItem(e)){if(!this._trigger(e,"beforefolder",d)){this._fail(e,d);return}if(this.isFile(e)){e.first().removeClass("aciTreeFile").addClass("aciTreeFolder");this._success(e,d)}else{this._notify(e,d)}}else{this._fail(e,d)}},setFile:function(e,d){d=this._options(d,function(){this._trigger(e,"fileset",d)},function(){this._trigger(e,"filefail",d)},function(){this._trigger(e,"wasfile",d)});if(this.isItem(e)){if(!this._trigger(e,"beforefile",d)){this._fail(e,d);return}if(this.isFolder(e)){var f=function(){e.first().removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile");this._success(e,d)};if(this.wasLoad(e)){this.unload(e,this._inner(d,{success:f,fail:d.fail}))}else{f.apply(this)}}else{this._notify(e,d)}}else{this._fail(e,d)}},setIcon:function(h,e){e=this._options(e,null,function(){this._trigger(h,"iconfail",e)});if(this.isItem(h)){if(!this._trigger(h,"beforeicon",e)){this._fail(h,e);return}var g=e.icon;var d=this.itemData(h);e.oldIcon=d.icon;var f=h.first().children(".aciTreeLine").find(".aciTreeItem");var i=f.children(".aciTreeIcon");if(i.length){if(g){if(g instanceof Array){i.attr("class","aciTreeIcon "+g[0]).css("background-position",g[1]+"px "+g[2]+"px")}else{i.attr("class","aciTreeIcon "+g)}d.icon=g;this._trigger(h,"iconset",e)}else{i.remove();d.icon=null;this._trigger(h,"iconremoved",e)}}else{if(g){if(g instanceof Array){f.prepend('<div class="aciTreeIcon '+g[0]+'" style="background-position:'+g[1]+"px "+g[2]+'px"></div>')}else{f.prepend('<div class="aciTreeIcon '+g+'"></div>')}d.icon=g;this._trigger(h,"iconadded",e)}else{this._trigger(h,"noticon",e)}}this._success(h,e)}else{this._fail(h,e)}},getIcon:function(e){var d=this.itemData(e);return d?d.icon:null},setLabel:function(g,f){f=this._options(f,null,function(i,h){this._trigger(i,"labelfail",h)},function(){this._trigger(g,"waslabel",f)});if(this.isItem(g)){if(!this._trigger(g,"beforelabel",f)){this._fail(g,f);return}var e=f.label;var d=this.itemData(g);f.oldLabel=d.label;if(e==f.oldLabel){this._notify(g,f)}else{g.first().children(".aciTreeLine").find(".aciTreeText").html(e);d.label=e;this._trigger(g,"labelset",f);this._success(g,f)}}else{this._fail(g,f)}},isOpen:function(d){return d&&d.first().hasClass("aciTreeOpen")},isClosed:function(d){return !this.isOpen(d)},hasChildrens:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:first").length>0},hasSiblings:function(d){return d&&(d.first().siblings(".aciTreeLi:first").length>0)},hasPrev:function(d){return this.prev(d).length>0},hasNext:function(d){return this.next(d).length>0},siblings:function(d){return d?d.first().siblings(".aciTreeLi"):b([])},prev:function(d){return d?d.first().prev(".aciTreeLi"):b([])},next:function(d){return d?d.first().next(".aciTreeLi"):b([])},level:function(d){var e=-1;if(d){d=d.first();while(d.hasClass("aciTreeLi")){d=d.parent().parent();e++}}return e},getId:function(e){var d=this.itemData(e);return d?d.id:null},itemData:function(d){return d?d.first().data("itemData"+this._instance.nameSpace):null},setId:function(f,e){e=this._options(e,null,function(){this._trigger(f,"idfail",e)},function(){this._trigger(f,"wasid",e)});if(this.isItem(f)){if(!this._trigger(f,"beforeid",e)){this._fail(f,e);return}var g=e.id;var d=this.itemData(f);e.oldId=d.id;if(g==e.oldId){this._notify(f,e)}else{d.id=g;this._trigger(f,"idset",e);this._success(f,e)}}else{this._fail(f,e)}},getIndex:function(d){return d?d.first().parent().children(".aciTreeLi").index(d.first()):null},setIndex:function(g,e){var d=e.index;e=this._options(e,null,function(){this._trigger(g,"indexfail",e)},function(){this._trigger(g,"wasindex",e)});if(this.isItem(g)){if(!this._trigger(g,"beforeindex",e)){this._fail(g,e);return}e.oldIndex=this.getIndex(g);var h=this.siblings(g);if((d!=e.oldIndex)&&h.length){if(d<1){h.first().before(g)}else{if(d>=h.length){h.last().after(g)}else{h.eq(d).before(g)}}var f=this.parent(g);this._updateFirstLast(f.length?f:null,g.add([h.get(0),h.get(-1)]));this._updateOddEven(f);this._trigger(g,"indexset",e);this._success(g,e)}else{this._notify(g,e)}}else{this._fail(g,e)}},getLabel:function(e){var d=this.itemData(e);return d?d.label:null},isItem:function(d){return d&&d.first().hasClass("aciTreeLi")},_animate:function(g,h,f,i){if(!g){g=this._instance.jQuery}if(!f){var e=h?this._instance.options.show:this._instance.options.hide;if(e){var d=g.first().children(".aciTreeUl");if(d.length){d.stop(true,true).animate(e.props,{duration:e.duration,easing:e.easing,complete:b.proxy(i,this)})}else{if(i){i.apply(this)}}return}}g.first().children(".aciTreeUl").stop(true,true).toggle(h);if(i){i.apply(this)}},first:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:first")},isFirst:function(e){if(e){var d=this.parent(e);return this.first(d.length?d:null).is(e.first())}return false},last:function(d){if(!d){d=this._instance.jQuery}return d.first().children(".aciTreeUl").children(".aciTreeLi:last")},isLast:function(e){if(e){var d=this.parent(e);return this.last(d.length?d:null).is(e.first())}return false},isBusy:function(d){if(d){return d.first().hasClass("aciTreeLoad")}else{return !this._private.loadQueue.empty()}},_loading:function(d,e){if(d){d.first().toggleClass("aciTreeLoad",e)}else{if(e){this._loader(e)}}},_loader:function(d){var e=this;if(d||this.isBusy()){if(!this._private.loaderInterval){this._private.loaderInterval=setInterval(function(){e._loader()},this._instance.options.loaderDelay)}this._instance.jQuery.toggleClass("aciTreeLoad",true);clearTimeout(this._private.loaderHide);this._private.loaderHide=setTimeout(function(){e._instance.jQuery.toggleClass("aciTreeLoad",false)},this._instance.options.loaderDelay*2)}},isChildren:function(e,d){if(!e){e=this._instance.jQuery}return d&&(e.has(d).length>0)},isImmediateChildren:function(e,d){if(!e){e=this._instance.jQuery}return d&&e.children(".aciTreeUl").children(".aciTreeLi").is(d)},sameParent:function(f,d){if(f&&d){var g=this.parent(f);var e=this.parent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},sameTopParent:function(f,d){if(f&&d){var g=this.topParent(f);var e=this.topParent(d);return(!g.length&&!e.length)||(g.get(0)==e.get(0))}return false},destroy:function(d){d=this._options(d);if(!this.wasInit()){this._trigger(null,"notinit",d);this._fail(null,d);return}if(this.isLocked()){this._trigger(null,"locked",d);this._fail(null,d);return}if(!this._trigger(null,"beforedestroy",d)){this._trigger(null,"destroyfail",d);this._fail(null,d);return}this._instance.locked=true;this._instance.jQuery.toggleClass("aciTreeLoad",true);this._private.loadQueue.destroy();this._destroyHook(false);var e=this._super;this.unload(null,this._inner(d,{success:function(){clearTimeout(this._private.loaderHide);clearInterval(this._private.loaderInterval);this._destroyHook(true);this._instance.jQuery.unbind(this._instance.nameSpace).off(this._instance.nameSpace,".aciTreeButton").off(this._instance.nameSpace,".aciTreeLine");this._instance.jQuery.toggleClass("aciTreeLoad",false);this._instance.locked=false;e.apply(this);this._trigger(null,"destroyed",d);this._success(null,d)},fail:function(){this._instance.jQuery.toggleClass("aciTreeLoad",false);this._instance.locked=false;this._trigger(null,"destroyfail",d);this._fail(null,d)}}))},_destroyHook:function(d){}};aciPluginClass.plugins.aciTree=aciPluginClass.aciPluginUi.extend(c,"aciTreeCore");aciPluginClass.publish("aciTree",a)})(jQuery);

// utils
(function(b){var a={__extend:function(){b.extend(this._private,{branchQueue:new this._queue(this._instance.options.threads,true).context(this)});this._super()},update:function(e,c){c=this._options(c,function(){this._trigger(e,"updated",c)},function(){this._trigger(e,"updatefail",c)});if(this.isItem(e)){if(!this._trigger(e,"beforeupdate",c)){this._fail(e,c);return}var d=function(){if(typeof c.itemData.id!="undefined"){this.setId(e,{id:c.itemData.id})}if(typeof c.itemData.label!="undefined"){this.setLabel(e,{label:c.itemData.label})}if(typeof c.itemData.icon!="undefined"){this.setIcon(e,{icon:c.itemData.icon})}};if(c.itemData.isFolder||(c.itemData.isFolder===null)){var f=function(){d.apply(this);e.first().removeClass("aciTreeFolder aciTreeFolderMaybe").addClass((c.itemData.isFolder||(c.itemData.childs&&c.itemData.childs.length))?"aciTreeFolder":"aciTreeFolderMaybe");if(c.itemData.childs){if(this.wasLoad(e)){this.unload(e,this._inner(c,{success:function(){this.loadFrom(e,this._inner(c,{success:c.success,fail:c.fail,itemData:c.itemData.childs}))},fail:c.fail}))}else{this.loadFrom(e,this._inner(c,{success:c.success,fail:c.fail,itemData:c.itemData.childs}))}}else{this._success(e,c)}};if(this.isFolder(e)){f.apply(this)}else{this.setFolder(e,this._inner(c,{success:f,fail:c.fail}))}}else{if(this.isFile(e)){d.apply(this)}else{this.setFile(e,this._inner(c,{success:d,fail:c.fail}))}}}else{this._fail(e,c)}},branch:function(c,h,d){var g=this;var f=this._private;var e=function(j,l,i){var k=i?g.next(j):g.first(j);if(k.length){if(g.isFolder(k)){if(g.wasLoad(k)){f.branchQueue.push(function(){l.call(this,k);e(k,l);e(k,l,true)}).run()}else{if(d){f.branchQueue.push(function(m){this.ajaxLoad(k,{success:function(){l.call(this,k);e(k,l);e(k,l,true);m()},fail:function(){e(k,l,true);m()}})},true).run()}else{f.branchQueue.push(function(){l.call(this,k);e(k,l,true)}).run()}}}else{f.branchQueue.push(function(){l.call(this,k);e(k,l,true)}).run()}}};e(c,h)},isBusy:function(c){if(c){return this._super(c)}else{return this._super(c)||!this._private.branchQueue.empty()}},swap:function(e){e=this._options(e,null,function(){this._trigger(null,"swapfail",e)});var d=e.item1;var c=e.item2;if(this.isItem(d)&&this.isItem(c)&&!this.isChildren(d,c)&&!this.isChildren(c,d)&&(d.get(0)!=c.get(0))){if(!this._trigger(null,"beforeswap",e)){this._fail(null,e);return}d=d.first();c=c.first();var h=this.prev(d);if(h.length){if(c.get(0)==h.get(0)){c.before(d)}else{d.insertAfter(c);c.insertAfter(h)}}else{var g=this.next(d);if(g.length){if(c.get(0)==g.get(0)){c.after(d)}else{d.insertAfter(c);c.insertBefore(g)}}else{var f=d.parent();d.insertAfter(c);f.append(c)}}this._updateLevel(d);var f=this.parent(d);this._updateFirstLast(f.length?f:null,d.add(c));this._updateVisibleState(f.length?f:null,d);this._updateLevel(c);f=this.parent(c);this._updateFirstLast(f.length?f:null,c.add(d));this._updateVisibleState(f.length?f:null,c);this._updateOddEven(d.add(c));this._trigger(null,"swapped",e);this._success(null,e)}else{this._fail(null,e)}},_updateLevel:function(f){var g=this.level(f);var e=f.find(".aciTreeBranch").length;if(e<g){var d=f.find(".aciTreeEntry");for(var c=g-1;c>=e;c--){d.wrap('<div class="aciTreeBranch aciTreeLevel'+c+'"></div>')}}else{if(e>g){var d=f.find(".aciTreeEntry");for(var c=g;c<e;c++){d.unwrap()}}}},_updateVisibleState:function(c,d){if(c){if(this.isOpenPath(c)&&this.isOpen(c)){d.first().addClass("aciTreeVisible");this._updateVisible(d,true)}else{this._updateVisible(d,false);d.first().removeClass("aciTreeVisible")}}else{d.first().addClass("aciTreeVisible");this._updateVisible(d,true)}},moveUp:function(d,c){c=this._options(c);c.index=this.getIndex(d)-1;this.setIndex(d,c)},moveDown:function(d,c){c=this._options(c);c.index=this.getIndex(d)+1;this.setIndex(d,c)},moveFirst:function(d,c){c=this._options(c);c.index=0;this.setIndex(d,c)},moveLast:function(d,c){c=this._options(c);c.index=Number.MAX_VALUE;this.setIndex(d,c)},_search:function(k,g){var j=this.childrens(k);var l,c,e,n,h=false;for(var f=0,m=j.length;f<m;f++){l=j.eq(f);c=String(this.getId(l));e=c.length;if(e){if(c==g.substr(0,e)){n=l;h=g.length==e;break}}}if(n){if(!h){var d=this._search(n,g);if(d){return d}}return{item:n,exact:h}}else{return null}},searchId:function(g,e,c){var i=this;c=this._options(c);var h=c.id;if(g){if(e){var f=function(j){var k=i._search(j,h);if(k){if(k.exact){i._success(k.item,c)}else{if(i.wasLoad(k.item)){i._fail(j,c)}else{i.ajaxLoad(k.item,i._inner(c,{success:function(){f(k.item)},fail:c.fail}))}}}else{i._fail(j,c)}};f()}else{var d=this._search(null,h);if(d&&d.exact){this._success(d.item,c)}else{this._fail(null,c)}}}else{var d=b();this._instance.jQuery.find(".aciTreeLi").each(function(){if(h==i.getId(b(this))){d=b(this);return false}});if(d.length){this._success(d,c)}else{this._fail(null,c)}}},_destroyHook:function(c){if(!c){this._private.branchQueue.destroy()}this._super(c)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a,"aciTreeUtils")})(jQuery);

// selectable
(function(b){var a={selectable:true,fullRow:false,textSelection:false};var c={__extend:function(){b.extend(this._instance,{focus:false});b.extend(this._private,{blurTimeout:null,focus:null});this._super()},hasFocus:function(){return this._instance.focus},_lastFocus:function(){return(this._instance.focus&&this._private.focus)?this._private.focus:b([])},_focus:function(d){clearTimeout(this._private.blurTimeout);this._private.focus=d;if(!this._instance.focus){this._instance.focus=true;this._instance.jQuery.addClass("aciTreeFocus");this._trigger(null,"focused")}},_blur:function(){clearTimeout(this._private.blurTimeout);this._private.blurTimeout=setTimeout(b.proxy(function(){if(this._instance.focus){this._instance.focus=false;this._instance.jQuery.removeClass("aciTreeFocus");this._trigger(null,"blurred")}},this),10)},_initSelectable:function(){var d=this;if(typeof this._instance.jQuery.attr("tabindex")=="undefined"){this._instance.jQuery.attr("tabindex",0)}this._instance.jQuery.bind("focusin"+this._private.nameSpace,function(f){d._focus(b(f.target))}).bind("focusout"+this._private.nameSpace,function(){d._blur()}).bind("keydown"+this._private.nameSpace,function(h){if(!d._instance.focus){return}var f=d.selected();if(f.length&&d.isBusy(f)){return false}var g=b([]);switch(h.which){case 38:g=f.length?d._prevOpen(f):d.first();break;case 40:g=f.length?d._nextOpen(f):d.first();break;case 37:if(f.length){if(d.isOpen(f)){d.close(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{g=d.parent(f)}}else{g=d.first()}break;case 39:if(f.length){if(d.isFolder(f)&&d.isClosed(f)){d.open(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}else{g=d.first(f)}}else{g=d.first()}break;case 33:g=f.length?d._prevPage(f):d.first();break;case 34:g=f.length?d._nextPage(f):d.first();break;case 36:g=d.first();break;case 35:g=d._lastOpen();break;case 13:if(f.length&&d.isFolder(f)&&d.isClosed(f)){d.open(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 27:if(f.length&&d.isOpen(f)){d.close(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break;case 32:if(f.length&&d.isFolder(f)){d.toggle(f,{collapse:d._instance.options.collapse,expand:d._instance.options.expand,unique:d._instance.options.unique})}break}if(g.length){if(!d.isSelected(g)){if(!d.isVisible(g)){d.setVisible(g)}d.select(g,{select:true});return false}else{if(!d.isVisible(g)){d.setVisible(g);return false}}}});this._fullRow(this._instance.options.fullRow)},_fullRow:function(d){var e=this;this._instance.jQuery.off(this._private.nameSpace,".aciTreeLine,.aciTreeItem").off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.on("click"+this._private.nameSpace,d?".aciTreeLine,.aciTreeItem":".aciTreeItem",function(g){var f=e.itemFrom(g.target);if(!e.isVisible(f)){e.setVisible(f)}if(!e.isSelected(f)){e.select(f,{select:true})}}).on("dblclick"+this._private.nameSpace,d?".aciTreeLine,.aciTreeItem":".aciTreeItem",function(g){var f=e.itemFrom(g.target);if(e.isFolder(f)){e.toggle(f,{collapse:e._instance.options.collapse,expand:e._instance.options.expand,unique:e._instance.options.unique});return false}})},_initHook:function(){if(this.isSelectable()){this._initSelectable()}this._super()},_itemHook:function(e,f,d,g){if(!this._instance.options.textSelection){this._selectable(f.children(".aciTreeLine").find(".aciTreeItem"))}this._super(e,f,d,g)},_selectable:function(d,e){if(e){d.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","-o-user-select":"text","user-select":"text"}).attr({unselectable:null,onselectstart:null}).unbind("selectstart"+this._private.nameSpace)}else{d.css({"-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).attr({unselectable:"on",onselectstart:"return false"}).bind("selectstart"+this._private.nameSpace,function(){return true})}},_lastOpen:function(d){var f=this;var e=function(h){var g=f.last(h);if(f.isOpen(g)){return e(g)}else{return g}};if(!d){d=this.last()}if(this.isOpen(d)){return e(d)}else{return d}},_prevOpen:function(f){var e=this.prev(f);if(e.length){return this._lastOpen(e)}else{var d=this.parent(f);return d.length?d:f}},_nextOpen:function(e){var g=this;var f=function(j){var i=g.parent(j);if(i.length){var h=g.next(i);if(h.length){return h}else{return f(i)}}return null};if(this.isOpen(e)){return this.first(e)}else{var d=this.next(e);if(d.length){return d}else{d=f(e);return d?d:e}}},_itemHeight:function(e){var d=e.first().children(".aciTreeLine").find(".aciTreeItem");return d.outerHeight(true)},_prevPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._prevOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_nextPage:function(g){var d=this._itemHeight(g);var h=this._instance.jQuery.height();var f=b([]),e=g;do{e=this._nextOpen(e);if(e.length){if(e.get(0)==f.get(0)){break}d+=this._itemHeight(e);f=e}else{break}}while(d<h);return e},_selectHook:function(d,e){},select:function(g,f){var h=this;f=this._options(f,null,function(){this._trigger(g,"selectfail",f)});if(this.isSelectable()&&this.isItem(g)){if(!this._trigger(g,"beforeselect",f)){this._fail(g,f);return}var d=f.select;var e=this._instance.jQuery.find(".aciTreeSelected");if(d){e=e.not(g.first())}f.oldSelected=this.selected();e.removeClass("aciTreeSelected").each(function(){h._trigger(b(this),"unselected",f)});if(d){if(this.isSelected(g)){this._trigger(g,"wasselected",f)}else{g.first().addClass("aciTreeSelected");this._selectHook(f.oldSelected,g);this._trigger(g,"selected",f)}}this._success(this,f)}else{this._fail(this,f)}},selected:function(){return this._instance.jQuery.find(".aciTreeSelected:first")},isSelected:function(d){return d&&d.first().hasClass("aciTreeSelected")},isSelectable:function(){return this._instance.options.selectable},option:function(d,e){var f=this;if(this.wasInit()&&!this.isLocked()){if((d=="selectable")&&(e!=this.isSelectable())){if(e){this._initSelectable()}else{this._doneSelectable()}}if((d=="fullRow")&&(e!=this._instance.options.fullRow)){this._fullRow(e)}if((d=="textSelection")&&(e!=this._instance.options.textSelection)){if(e){this._instance.jQuery.find(".aciTreeItem").each(function(){f._selectable(b(this),true)})}else{this._instance.jQuery.find(".aciTreeItem").each(function(){f._selectable(b(this))})}}}this._super(d,e)},_doneSelectable:function(d){if(this._instance.jQuery.attr("tabindex")=="0"){this._instance.jQuery.removeAttr("tabindex")}this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.removeClass("aciTreeFocus");this._instance.focus=false;if(!d){var e=this.selected();if(e.length){this.select(e,{select:false})}}},_destroyHook:function(d){if(d){this._doneSelectable(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeSelectable");aciPluginClass.defaults("aciTree",a)})(jQuery);

// checkbox
(function(c){var b={checkbox:false,checkboxName:"check[]"};var a={_initCheckbox:function(){var d=this;this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(i,g,h,e,f){switch(e){case"loaded":if(h){g._loadCheckbox(h)}break;case"focused":g._checkbox(g.selected()).focus();break;case"selected":g._checkbox(h).focus();break}}).bind("keydown"+this._private.nameSpace,function(g){switch(g.which){case 9:case 32:if(d.isSelectable){var f=d.selected();if(d.hasCheckbox(f)){if(d._lastFocus().get(0)==d._instance.jQuery.get(0)){d._checkbox(f).focus().trigger(g)}g.stopImmediatePropagation()}}break}}).on("click"+this._private.nameSpace,".aciTreeItem",function(g){if(c(g.target).hasClass("aciTreeItem")){var f=d.itemFrom(g.target);if(d.hasCheckbox(f)){d._checkbox(f).focus();d.check(f,{check:!d.isChecked(f)});g.preventDefault()}}}).on("focus"+this._private.nameSpace,"input[type=checkbox]",function(g){var f=d.itemFrom(g.target);if(d.isSelectable&&!d.isSelected(f)){d.select(f,true)}}).on("click"+this._private.nameSpace,"input[type=checkbox]",function(g){var f=d.itemFrom(g.target);d.check(f,{check:c(this).is(":checked")})}).on("keydown"+this._private.nameSpace,"input[type=checkbox]",function(g){switch(g.which){case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 13:case 27:g.preventDefault();break;case 9:case 32:if(d.isSelectable){var f=d.itemFrom(g.target);if(!d.isSelected(f)){return false}}g.stopPropagation();break}})},_checkbox:function(d){return d?d.first().children(".aciTreeLine").find("input[type=checkbox]"):c([])},_initHook:function(){if(this.isCheckbox()){this._initCheckbox()}this._super()},_itemHook:function(f,g,d,h){if(this.isCheckbox()){var e=this.isRadio&&this.hasRadio(g);if(!e&&(d.checkbox||(typeof d.checkbox=="undefined"))){this._addCheckbox(g,d)}}this._super(f,g,d,h)},_selectHook:function(e,f){var d=this._super(e,f);if(d){return true}if(this.isCheckbox()&&this.hasCheckbox(e)&&!this.hasCheckbox(f)){var g=this._checkbox(e);if(g.is(":focus")){g.blur();this._instance.jQuery.focus();return true}}},_addCheckbox:function(f,d){var e=d.checkboxName?d.checkboxName:this._instance.options.checkboxName;f.first().addClass("aciTreeCheckbox").children(".aciTreeLine").find(".aciTreeText").wrap("<label></label>").before('<input type="checkbox" name="'+e+'" value="'+this.getId(f)+'"'+(d.checked?' checked="checked"':"")+" />")},_removeCheckbox:function(e){var d=e.first().removeClass("aciTreeCheckbox").children(".aciTreeLine").find("label");if(d.length){d.find("*").not(".aciTreeText").remove();d.find(".aciTreeText").unwrap()}},setId:function(e,d){d=this._options(d,function(f){if(this.isCheckbox()&&this.hasCheckbox(f)){this._checkbox(f).attr("value",this.getId(f))}});this._super(e,d)},_loadCheckbox:function(d){if(this.hasCheckbox(d)){if(this.isChecked(d)){if(this.checkboxes(this.childrens(d),true).length){this._parentCheckbox(d)}else{this._childCheckbox(d)}}else{this._childCheckbox(d)}}},_childCheckbox:function(d){var g=this;var e=this._checkbox(d).removeClass("aciTreeTristate").is(":checked");var f=function(h){g.checkboxes(g.childrens(h)).each(function(){g._checkbox(c(this)).prop("checked",e).removeClass("aciTreeTristate");f(c(this))})};f(d)},_parentCheckbox:function(d){var e=this;this.path(d,true).each(function(){if(!e.hasCheckbox(c(this))){return false}var h=e.checkboxes(e.childrens(c(this)));if(h.length){var g=e.checkboxes(h,true).length;if(g){var f=(g!=h.length)||(h.find(".aciTreeTristate").length>0);e._checkbox(c(this)).prop("checked",true).toggleClass("aciTreeTristate",f)}else{e._checkbox(c(this)).prop("checked",false).removeClass("aciTreeTristate")}}else{e._checkbox(c(this)).removeClass("aciTreeTristate")}})},hasCheckbox:function(d){return d&&d.hasClass("aciTreeCheckbox")},_stateCheckbox:function(g,d){var e=this.parent(g);var h=this.checkboxes(this.childrens(g));var f=this.checkboxes(h,true);if(this.hasCheckbox(e)){if(this.isChecked(e)){var i=this.checkboxes(this.siblings(g));if(i.length){if(f.length){this._parentCheckbox(f)}else{this._parentCheckbox(g)}}else{this._checkbox(g).prop("checked",true);this._trigger(g,"checkboxadded",d);if(h.length&&!f.length){this.check(g,this._inner(d,{check:true}))}return}}else{if(f.length){this._parentCheckbox(f)}}}else{if(f.length){this._parentCheckbox(f)}}this._trigger(g,"checkboxadded",d)},setCheckbox:function(g,e){e=this._options(e,null,function(){this._trigger(g,"checkboxfail",e)});if(this.isCheckbox()&&this.isItem(g)){if(!this._trigger(g,"beforecheckbox",e)){this._fail(g,e);return}var h=!!e.checkbox;var f=e.checked;var d=e.checkboxName;if(h==this.hasCheckbox(g)){if(h){if(typeof d!="undefined"){this._checkbox(g).attr("name",d?d:this._instance.options.checkboxName)}if(typeof f!="undefined"){this.check(g,this._inner(e,{check:f}))}this._trigger(g,"checkboxset",e)}else{this._trigger(g,"notcheckbox",e)}this._success(g,e)}else{if(h){var i=function(){this._addCheckbox(g,{id:this.getId(g),checkboxName:d});if(typeof f=="undefined"){this._stateCheckbox(g,e)}else{this.check(g,this._inner(e,{check:f}));this._trigger(g,"checkboxadded",e)}this._success(g,e)};if(this.isRadio&&this.hasRadio(g)){this.setRadio(g,this._inner(e,{success:i,fail:e.fail,radio:false}))}else{i.apply(this)}}else{this._removeCheckbox(g);this._parentCheckbox(g);this._trigger(g,"checkboxremoved",e);this._success(g,e)}}}else{this._fail(g,e)}},isChecked:function(d){if(this.hasCheckbox(d)){return this._checkbox(d).is(":checked")}if(this._super){return this._super(d)}return false},check:function(f,e){e=this._options(e,null,function(){this._trigger(f,"checkfail",e)});if(this.isCheckbox()&&this.hasCheckbox(f)){if(!this._trigger(f,"beforecheck",e)){this._fail(f,e);return}var d=e.check;this._checkbox(f).prop("checked",d);this._childCheckbox(f);this._parentCheckbox(f);this._trigger(f,d?"checked":"unchecked",e);this._success(f,e)}else{if(this._super){this._super(f,e)}else{this._fail(f,e)}}},checkboxes:function(d,f){var g=this,e=[];if(typeof f=="undefined"){return d.filter(".aciTreeCheckbox")}d.filter(".aciTreeCheckbox").each(function(){if(f==g._checkbox(c(this)).is(":checked")){e[e.length]=this}});return c(e)},isCheckbox:function(){return this._instance.options.checkbox},option:function(d,e){if(this.wasInit()&&!this.isLocked()){if((d=="checkbox")&&(e!=this.isCheckbox())){if(e){this._initCheckbox()}else{this._doneCheckbox()}}}this._super(d,e)},_doneCheckbox:function(d){var e=this;this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=checkbox]");if(!d){this.checkboxes(this.childrens(null,true)).each(function(){e.setCheckbox(c(this),false)})}},_destroyHook:function(d){if(d){this._doneCheckbox(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a,"aciTreeCheckbox");aciPluginClass.defaults("aciTree",b)})(jQuery);

// radio
(function(c){var a={radio:false,radioName:"radio"};var b={_initRadio:function(){var d=this;this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(i,g,h,e,f){switch(e){case"loaded":if(h){g._loadRadio(h)}break;case"focused":g._radio(g.selected()).focus();break;case"selected":g._radio(h).focus();break}}).bind("keydown"+this._private.nameSpace,function(g){switch(g.which){case 9:case 32:if(d.isSelectable){var f=d.selected();if(d.hasRadio(f)){if(d._lastFocus().get(0)==d._instance.jQuery.get(0)){d._radio(f).focus().trigger(g)}g.stopImmediatePropagation()}}break}}).on("click"+this._private.nameSpace,".aciTreeItem",function(g){if(c(g.target).hasClass("aciTreeItem")){var f=d.itemFrom(g.target);if(d.hasRadio(f)&&!d.isChecked(f)){d._radio(f).focus();d.check(f,{check:true});g.preventDefault()}}}).on("focus"+this._private.nameSpace,"input[type=radio]",function(g){var f=d.itemFrom(g.target);if(d.isSelectable&&!d.isSelected(f)){d.select(f,true)}}).on("click"+this._private.nameSpace,"input[type=radio]",function(g){var f=d.itemFrom(g.target);d.check(f,{check:c(this).is(":checked")})}).on("keydown"+this._private.nameSpace,"input[type=radio]",function(g){switch(g.which){case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 13:case 27:g.preventDefault();break;case 9:case 32:if(d.isSelectable){var f=d.itemFrom(g.target);if(!d.isSelected(f)){return false}}g.stopPropagation();break}})},_radio:function(d){return d.first().children(".aciTreeLine").find("input[type=radio]")},_initHook:function(){if(this.isRadio()){this._initRadio()}this._super()},_itemHook:function(e,f,d,h){if(this.isRadio()){var g=this.isCheckbox&&this.hasCheckbox(f);if(!g&&(d.radio||(typeof d.radio=="undefined"))){this._addRadio(e,f,d)}}this._super(e,f,d,h)},_selectHook:function(f,g){var d=this._super(f,g);if(d){return true}if(this.isRadio()&&this.hasRadio(f)&&!this.hasRadio(g)){var e=this._radio(f);if(e.is(":focus")){e.blur();this._instance.jQuery.focus();return true}}},_addRadio:function(f,g,d){var i=String(d.id).replace(/[^a-z0-9_-]/ig,"");var e=d.radioName?d.radioName:null;if(!e){var h=this.getId(f);e=this._instance.options.radioName+"-"+(h?String(h).replace(/[^a-z0-9_-]/ig,""):"root")}g.first().addClass("aciTreeRadio").children(".aciTreeLine").find(".aciTreeText").wrap("<label></label>").before('<input type="radio" name="'+e+'" value="'+this.getId(g)+'"'+(d.checked?' checked="checked"':"")+" />")},_removeRadio:function(e){var d=e.first().removeClass("aciTreeRadio").children(".aciTreeLine").find("label");if(d.length){d.find("*").not(".aciTreeText").remove();d.find(".aciTreeText").unwrap()}},setId:function(e,d){d=this._options(d,function(f){if(this.isRadio()&&this.hasRadio(f)){this._radio(f).attr("value",this.getId(f))}});this._super(e,d)},_loadRadio:function(d){if(this.hasRadio(d)){if(this.isChecked(d)){if(!this.radios(this.childrens(d),true).length){this._childRadio(d)}}else{this._childRadio(d)}}},_childRadio:function(d){var g=this;var f=function(i,j){var k=g.radios(g.childrens(i));if(j){var h=g.radios(k,true);if(h.length){f(h,true);k=k.not(h.first())}else{if(k.length){g._radio(k).prop("checked",true);f(k,true);k=k.slice(1)}}}k.each(function(){g._radio(c(this)).prop("checked",false);f(c(this),false)})};var e=this._radio(d).is(":checked");f(d,e)},_parentRadio:function(d){var g=this;var f=function(h){g.radios(g.siblings(h)).each(function(){g._radio(c(this)).prop("checked",false);g._childRadio(c(this))})};f(d);var e=this._radio(d).is(":checked");this.path(d,true).each(function(){if(!g.hasRadio(c(this))){return false}g._radio(c(this)).prop("checked",e);f(c(this))})},hasRadio:function(d){return d&&d.hasClass("aciTreeRadio")},_stateRadio:function(g,d){var e=this.parent(g);var f=this.radios(this.childrens(g),true);if(this.hasRadio(e)){if(this.isChecked(e)){var h=this.radios(this.siblings(g),true);if(h.length){this._childRadio(g)}else{this._trigger(g,"radioadded",d);this.check(g,this._inner(d,{check:true}));return}}else{this._childRadio(g)}}else{if(f.length){this._parentRadio(f)}}this._trigger(g,"radioadded",d)},setRadio:function(h,e){e=this._options(e,null,function(){this._trigger(h,"radiofail",e)});if(this.isRadio()&&this.isItem(h)){if(!this._trigger(h,"beforeradio",e)){this._fail(h,e);return}var d=!!e.radio;var g=e.checked;var f=e.radioName;if(d==this.hasRadio(h)){if(d){if(typeof f!="undefined"){if(!f){var j=this.getId(this.parent(h));var f=this._instance.options.radioName+"-"+(j?String(j).replace(/[^a-z0-9_-]/ig,""):"root")}this._radio(h).attr("name",f)}if(typeof g!="undefined"){this.check(h,this._inner(e,{check:g}))}this._trigger(h,"radioset",e)}else{this._trigger(h,"notradio",e)}this._success(h,e)}else{if(d){var i=function(){this._addRadio(this.parent(h),h.first(),{id:this.getId(h),radioName:f});if(typeof g=="undefined"){this._stateRadio(h,e)}else{this.check(h,this._inner(e,{check:g}));this._trigger(h,"radioadded",e)}this._success(h,e)};if(this.isCheckbox&&this.hasCheckbox(h)){this.setCheckbox(h,this._inner(e,{success:i,fail:e.fail,checkbox:false}))}else{i.apply(this)}}else{g=this._radio(h).is(":checked");this._removeRadio(h.first());if(g){this.check(this.radios(this.siblings(h)).first(),this._inner(e,{check:true}))}this._trigger(h,"radioremoved",e);this._success(h,e)}}}else{this._fail(h,e)}},isChecked:function(d){if(this.hasRadio(d)){return this._radio(d).is(":checked")}if(this._super){return this._super(d)}return false},check:function(f,e){e=this._options(e,null,function(){this._trigger(f,"checkfail",e)});if(this.isRadio()&&this.hasRadio(f)){if(!this._trigger(f,"beforecheck",e)){this._fail(f,e);return}var d=e.check;this._radio(f).prop("checked",d);this._childRadio(f);this._parentRadio(f);this._trigger(f,d?"checked":"unchecked",e);this._success(f,e)}else{if(this._super){this._super(f,e)}else{this._fail(f,e)}}},radios:function(d,f){var g=this,e=[];if(typeof f=="undefined"){return d.filter(".aciTreeRadio")}d.filter(".aciTreeRadio").each(function(){if(f==g._radio(c(this)).is(":checked")){e[e.length]=this}});return c(e)},isRadio:function(){return this._instance.options.radio},option:function(d,e){if(this.wasInit()&&!this.isLocked()){if((d=="radio")&&(e!=this.isRadio())){if(e){this._initRadio()}else{this._doneRadio()}}}this._super(d,e)},_doneRadio:function(d){var e=this;this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=radio]");if(!d){this.radios(this.childrens(null,true)).each(function(){e.setRadio(c(this),false)})}},_destroyHook:function(d){if(d){this._doneRadio(true)}this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeRadio");aciPluginClass.defaults("aciTree",a)})(jQuery);

// column
(function(c){var a={columnData:[]};var b={_initHook:function(){if(this._instance.options.columnData.length){var d=0,g=0,j=false,h;for(var e in this._instance.options.columnData){h=this._instance.options.columnData[e];if(typeof h.width!="undefined"){g+=h.width;j=true}else{g+=this._getCss(["aciTree","aciTreeColumn"+d],"width",true)}d++}if(j){var f=this._getCss(["aciTree","aciTreeIcon"],"width",true);g+=this._getCss(["aciTree","aciTreeItem"],"padding-left",true)+this._getCss(["aciTree","aciTreeItem"],"padding-right",true);this._updateCss(".aciTree .aciTreeItem","margin-right:"+(f+g)+"px;");this._updateCss(".aciTree[dir=rtl] .aciTreeItem","margin-left:"+(f+g)+"px;")}}this._super()},_getCss:function(j,m,l){var e="_getCss_"+String(j).replace(/[^a-z0-9_-]/ig,"_");var h=c("body").find("#"+e);if(!h.length){if(j instanceof Array){var d="",f="";for(var g in j){d+='<div class="'+j[g]+'">';f+="</div>"}d+=f}else{var d='<div class="'+j+'"></div>'}c("body").append('<div id="'+e+'" style="position:relative;width:0px;height:0px;line-height:0px">'+d+"</div>");h=c("body").find("#"+e)}var k=h.find("*:last").css(m);if(l){k=parseInt(k);if(isNaN(k)){k=null}}return k},_updateCss:function(f,d){var h="_updateCss_"+String(f).replace(">","_gt_").replace(/[^a-z0-9_-]/ig,"_");var e='<style id="'+h+'" type="text/css">'+f+"{"+d+";}</style>";var g=c("body").find("#"+h);if(g.length){g.replaceWith(e)}else{c("body").prepend(e)}},_itemHook:function(l,m,f,d){if(this._instance.options.columnData.length){var j=m.children(".aciTreeLine").find(".aciTreeEntry");var k=0,h,e;for(var g in this._instance.options.columnData){h=this._instance.options.columnData[g];e=this._createColumn(f,h,k);j.prepend(e);k++}}this._super(l,m,f,d)},_createColumn:function(d,g,e){var f=(typeof g.width!="undefined")?' style="width:'+g.width+'px"':"";var h=g.props&&(typeof d[g.props]!="undefined")?d[g.props]:((typeof g.value=="undefined")?"":g.value);return c('<div class="aciTreeColumn aciTreeColumn'+e+'"'+f+">"+(h.length?h:"&nbsp;")+"</div>")}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeColumn");aciPluginClass.defaults("aciTree",a)})(jQuery);

// editable
(function(b){var a={editable:false};var c={_initEditable:function(){var d=this;this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(i,g,h,e,f){switch(e){case"blurred":var j=g.edited();if(j.length){g.edit(j,{edit:false,save:true})}break;case"unselected":if(g.isEdited(h)){g.edit(h,{edit:false,save:true})}break}}).bind("click"+this._private.nameSpace,function(){var e=d.edited();if(e.length){d.edit(e,{edit:false,save:true})}}).bind("keydown"+this._private.nameSpace,function(g){switch(g.which){case 113:if(d.isSelectable){var f=d.selected();if(!d.isEdited(f)){d.edit(f,{edit:true})}}break}}).on("mouseup"+this._private.nameSpace,".aciTreeItem",function(g){if(b(g.target).is(".aciTreeItem,.aciTreeText")){var f=d.itemFrom(g.target);if(d.isSelectable&&d.isSelected(f)){d.edit(f,{edit:true})}}}).on("dblclick"+this._private.nameSpace,".aciTreeItem",function(g){if(d.isSelectable&&!d.isSelectable()){var f=d.itemFrom(g.target);d.edit(f,{edit:true})}}).on("keydown"+this._private.nameSpace,"input[type=text]",function(g){switch(g.which){case 13:var f=d.itemFrom(g.target);d.edit(f,{edit:false,save:true});d._instance.jQuery.focus();g.stopPropagation();break;case 27:var f=d.itemFrom(g.target);d.edit(f,{edit:false});d._instance.jQuery.focus();g.preventDefault();g.stopPropagation();break;case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 32:g.stopPropagation();break}}).on("blur"+this._private.nameSpace,"input[type=text]",function(){if(d.isSelectable&&!d.isSelectable()){var e=d.edited();d.edit(e,{edit:false,save:true})}}).on("dblclick"+this._private.nameSpace,"input[type=text]",function(f){f.stopPropagation()})},_initHook:function(){if(this.isEditable()){this._initEditable()}this._super()},_editbox:function(d){return d?d.first().children(".aciTreeLine").find("input[type=text]"):b([])},_addEditbox:function(e){var d=e.first().addClass("aciTreeEdited").children(".aciTreeLine");var f="editable_"+String(this.getId(e)).replace(/[^a-z0-9_-]/ig,"");d.find(".aciTreeText").html('<input id="'+f+'" type="text" value="" />');d.find("label").attr("for",f);this._editbox(e).val(this.getLabel(e))},_removeEditbox:function(e){var d=e.first().removeClass("aciTreeEdited").children(".aciTreeLine");d.find(".aciTreeText").html(this.getLabel(e));d.find("label").removeAttr("for")},edited:function(){return this._instance.jQuery.find(".aciTreeEdited:first")},isEdited:function(d){return d&&d.first().hasClass("aciTreeEdited")},_focusEdit:function(e){var f=this._editbox(e).focus().trigger("click").get(0);if(f){if(typeof f.selectionStart=="number"){f.selectionStart=f.selectionEnd=f.value.length}else{if(typeof f.createTextRange!="undefined"){var d=f.createTextRange();d.collapse(false);d.select()}}}},setLabel:function(e,d){d=this._options(d,function(g){if(this.isEditable()&&this.isEdited(g)){var f=this._editbox(g).is(":focus");this._addEditbox(g);if(f){this._focusEdit(g)}}});this._super(e,d)},edit:function(g,d){d=this._options(d,null,function(){this._trigger(g,"editfail",d)});if(this.isEditable()&&this.isItem(g)){if(!this._trigger(g,"beforeedit",d)){this._fail(g,d);return}var f=d.edit;var e=d.save;if(f&&this.isEdited(g)){if(e){var h=this._editbox(g).val();this.setLabel(g,{label:h})}this._trigger(i,"wasedit",d)}else{var i=this.edited();if(i.length){var h=this._editbox(i).val();this._removeEditbox(i);if(e){this.setLabel(i,{label:h})}this._trigger(i,"editstop",d)}if(f){if(this.isSelectable&&!this.isSelected(g)){this.select(g,true)}this._addEditbox(g);this._focusEdit(g);this._trigger(g,"editstart",d)}}this._success(this,d)}else{this._fail(this,d)}},isEditable:function(){return this._instance.options.editable},option:function(d,e){if(this.wasInit()&&!this.isLocked()){if((d=="editable")&&(e!=this.isEditable())){if(e){this._initEditable()}else{this._doneEditable()}}}this._super(d,e)},_doneEditable:function(){this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=text]");var d=this.edited();if(d.length){this.edit(d,{edit:false,save:true})}},_destroyHook:function(d){this._doneEditable();this._super(d)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeEditable");aciPluginClass.defaults("aciTree",a)})(jQuery);
