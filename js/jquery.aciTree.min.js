
/*
 * aciTree jQuery Plugin v1.2
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library http://jquery.com
 *
 * Date: Fri Feb 08 18:20 2013 +0200
 */

(function(a){a.aciTree={nameSpace:".aciTree"};a.fn.aciTree=function(c,e,f){var b=null;for(var d=0;d<this.length;d++){b=a(this[d])._aciTree(c,e,f);if(!(b instanceof jQuery)){return b}}return this};a.fn.aciTree.defaults={json:null,root:null,expand:false,collapse:false,empty:false,show:{props:{height:"show",marginTop:"show",marginBottom:"show",paddingTop:"show",paddingBottom:"show"},duration:"medium",easing:"linear"},hide:{props:{height:"hide",marginTop:"hide",marginBottom:"hide",paddingTop:"hide",paddingBottom:"hide"},duration:"medium",easing:"linear"},animateRoot:true,autoInit:true,callbacks:{beforeInit:null,afterInit:null,item:null}};a.fn._aciTree=function(w,J,M){var q=this;var X=q.data(a.aciTree.nameSpace);if(!X&&((typeof w=="undefined")||(typeof w=="object"))){X={options:a.extend({},a.fn.aciTree.defaults,w),wasInit:false};q.data(a.aciTree.nameSpace,X)}var T=function(){if(!X||X.wasInit){return}X.wasInit=true;if(X.options.callbacks&&X.options.callbacks.beforeInit){X.options.callbacks.beforeInit(q)}q.on("click"+a.aciTree.nameSpace,".aciTreeButton",function(af){var ae=a(af.target).parent();z(ae)});if(X.options.root){ab(null,X.options.root)}else{S()}if(X.options.callbacks&&X.options.callbacks.afterInit){X.options.callbacks.afterInit(q)}};var C=function(af,ae,ag){if(X.options.callbacks&&X.options.callbacks.item){X.options.callbacks.item(q,af,ae,ag);return}af.find(".aciTreeItem").html(ae.item)};var K=function(af){var ag=[];var ae=af.parent().parent();if(ae.hasClass("aciTreeLi")){ag=ag.concat(K(ae),ae.get(0))}return ag};var r=function(ae){if(ae){return a(K(ae.first()))}return a([])};var l=function(af){if(af){var ae=af.first().parent().parent();return ae.hasClass("aciTreeLi")}return false};var O=function(ae){return ae?ae.first().parent().parent().filter(".aciTreeLi"):a([])};var I=function(am,aj,ae,al){var ak=a('<ul class="aciTreeUl" style="display:none"></ul>');if((ae==0)&&(aj.length==1)){ak.addClass("aciTreeSingle")}am.append(ak);var af,an,ai;var ao=r(am).add(am);for(var ah in aj){af=aj[ah];an=a('<li class="aciTreeLi"></li>').data("id"+a.aciTree.nameSpace,af.id);ai="";for(var ag=0;ag<ae;ag++){ai+='<span class="aciTreeSpace '+(F(ao.eq(ag))?" aciTreeBranch":"")+'"></span>'}ai+='<span class="aciTreeButton"><span></span></span>';if(af.props&&af.props.icon){if(af.props.icon instanceof Array){ai+='<span class="aciTreeIcon '+af.props.icon[0]+'" style="background-position:'+af.props.icon[1]+"px "+af.props.icon[2]+'px"></span>'}else{ai+='<span class="aciTreeIcon '+af.props.icon+'"></span>'}}ai+='<span class="aciTreeItem"></span>';an.append(ai);ak.append(an);if(af.props&&(af.props.isFolder||(af.props.isFolder===null))){an.addClass((af.props.isFolder||(af.items&&af.items.length))?"aciTreeFolder":"aciTreeFolderMaybe");if(af.items&&af.items.length){I(an,af.items,ae+1,af.props.open)}if(af.props.open){E(an)}}else{an.addClass("aciTreeFile")}C(an,af,ae)}if(al){G(ak,true)}};var G=function(af,ae,ah){var ag=ae?X.options.show:X.options.hide;af.stop(true).animate(ag.props,{duration:ag.duration,easing:ag.easing,complete:ah})};var u=function(aj,ak,af,ag,am,ae){var al=a('<li class="aciTreeLi"></li>').data("id"+a.aciTree.nameSpace,ag.id);var ai="";for(var ah=0;ah<ae;ah++){ai+='<span class="aciTreeSpace '+(F(am.eq(ah))?" aciTreeBranch":"")+'"></span>'}ai+='<span class="aciTreeButton"><span></span></span>';if(ag.props&&ag.props.icon){if(ag.props.icon instanceof Array){ai+='<span class="aciTreeIcon '+ag.props.icon[0]+'" style="background-position:'+ag.props.icon[1]+"px "+ag.props.icon[2]+'px"></span>'}else{ai+='<span class="aciTreeIcon '+ag.props.icon+'"></span>'}}ai+='<span class="aciTreeItem"></span>';al.append(ai);if(aj){aj.append(al)}else{if(ak){ak.before(al)}else{if(af){af.after(al)}}}if(ag.props&&(ag.props.isFolder||(ag.props.isFolder===null))){al.addClass((ag.props.isFolder||(ag.items&&ag.items.length))?"aciTreeFolder":"aciTreeFolderMaybe")}else{al.addClass("aciTreeFile")}C(al,ag,ae);return al};var j=function(aj,ak,af,ag,am,ae){if(ag instanceof Array){var ai=[];if(!aj&&!ak&&af){ag.reverse()}for(var ah in ag){ai[ai.length]=u(aj,ak,af,ag[ah],am,ae).get(0)}if(aj){if(ai.length){v(e(a(ai[0])))}}else{if(ak){}else{if(af){v(af)}}}return a(ai)}var al=u(aj,ak,af,ag,am,ae);if(aj){v(e(al))}else{if(ak){}else{if(af){v(af)}}}return al};var H=function(ag,ae){if(ag){ag=ag.first();if(R(ag)){var af=ag.find(">.aciTreeUl");if(!af.length){af=a('<ul class="aciTreeUl" style="display:none"></ul>');ag.append(af)}var ah=j(af,null,null,ae,r(ag).add(ag),g(ag)+1);if(ah.length){ag.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder")}return ah}return a([])}else{var af=q.find(">.aciTreeUl");if(!af.length){af=a('<ul class="aciTreeUl"></ul>');q.append(af)}var ah=j(af,null,null,ae,null,0);q.find(">.aciTreeUl").toggleClass("aciTreeSingle",W().length==1);return ah}};var k=function(ae){if((g(ae)==0)&&(W().length>1)){q.find(">.aciTreeUl").removeClass("aciTreeSingle")}};var D=function(af,ae){if(af){af=af.first();if(n(af)){var ag=j(null,af,null,ae,r(af),g(af));k(af);return ag}}return a([])};var Y=function(af,ae){if(af){af=af.first();if(n(af)){var ag=j(null,null,af,ae,r(af),g(af));k(af);return ag}}return a([])};var aa=function(ae){if(ae){var af=a(ae).first();if(af.hasClass("aciTree")){return a([])}else{if(af.hasClass("aciTreeLi")){return af}else{return af.parents(".aciTreeLi:first")}}}return a([])};var W=function(ae){if(!ae){ae=q}return ae.first().find(">.aciTreeUl>.aciTreeLi")};var z=function(ae){ae.each(function(){var af=a(this);if(R(af)){if(af.hasClass("aciTreeOpen")){af.removeClass("aciTreeOpen");G(af.find(">.aciTreeUl"),false,function(){if(X.options.empty){a(this).remove()}});V(af,X.options.collapse)}else{af.addClass("aciTreeOpen");if(y(af)){G(af.find(">.aciTreeUl"),true);s(af,X.options.expand)}else{S(af,function(){G(af.find(">.aciTreeUl"),true);s(af,X.options.expand)})}}}})};var R=function(ae){return ae&&(ae.first().hasClass("aciTreeFolder")||ae.first().hasClass("aciTreeFolderMaybe"))};var ad=function(ae){return ae&&ae.first().hasClass("aciTreeFile")};var y=function(ae){if(!ae){return q.find(">.aciTreeUl").length>0}if(R(ae)){return ae.first().find(">.aciTreeUl").length>0}return true};var b=function(ae){if(ae){ae.each(function(){var af=a(this);if(n(af)){af.find(">.aciTreeUl").remove();h(af)}})}else{q.html("")}};var v=function(af){if(R(af)){var ag=g(af);var ae=F(af);af.find(".aciTreeLi").each(function(){a(this).find(">.aciTreeSpace").eq(ag).toggleClass("aciTreeBranch",ae)})}};var x=function(ae){if(ae){ae.each(function(){var ah=a(this);if(n(ah)){var af=O(ah);var ag=e(ah);var ai=g(ah);ah.remove();if(!W(af).length){b(af)}v(ag);if((ai==0)&&(W().length==1)){q.find(">.aciTreeUl").addClass("aciTreeSingle")}}})}else{q.html("")}};var A=function(ae){ae.each(function(){var af=a(this);if(ad(af)){af.removeClass("aciTreeFile").addClass("aciTreeFolderMaybe")}})};var U=function(ae){ae.each(function(){var af=a(this);if(R(af)){b(af);af.removeClass("aciTreeFolder aciTreeFolderMaybe aciTreeOpen").addClass("aciTreeFile")}})};var N=function(ae,af){ae.each(function(){var ag=a(this);if(n(ag)){var ah=ag.find(">.aciTreeIcon");if(ah.length){if(af){if(af instanceof Array){ah.attr("class","aciTreeIcon").addClass(af[0]).css("background-position",af[1]+"px "+af[2]+"px")}else{ah.attr("class","aciTreeIcon").addClass(af)}}else{ah.remove()}}else{if(af){if(af instanceof Array){ag.find(">.aciTreeButton").after('<span class="aciTreeIcon '+af[0]+'" style="background-position:'+af[1]+"px "+af[2]+'px"></span>')}else{ag.find(">.aciTreeButton").after('<span class="aciTreeIcon '+af+'"></span>')}}}}})};var s=function(af,ae){if(ae){var ag=W(af);ag.each(function(){E(a(this),true)})}};var V=function(af,ae){if(ae){var ag=W(af);ag.each(function(){h(a(this),true)})}};var E=function(af,ae){af.each(function(){var ag=a(this);if(R(ag)){if(!ag.hasClass("aciTreeOpen")){ag.addClass("aciTreeOpen");if(y(ag)){G(ag.find(">.aciTreeUl"),true);s(ag,ae)}else{S(ag,function(){G(ag.find(">.aciTreeUl"),true);s(ag,ae)})}}}})};var h=function(af,ae){af.each(function(){var ag=a(this);if(R(ag)){if(ag.hasClass("aciTreeOpen")){ag.removeClass("aciTreeOpen");G(ag.find(">.aciTreeUl"),false,function(){if(X.options.empty){a(this).remove()}});V(ag,ae)}}})};var f=function(ae){return ae&&ae.first().hasClass("aciTreeOpen")};var L=function(ae){return !f(ae)};var ac=function(ae){if(!ae){ae=q}return ae.first().find(">.aciTreeUl").length>0};var p=function(ae){return ae&&(ae.first().parent().find(">.aciTreeLi").length>1)};var i=function(ae){return ae&&(ae.first().prev(".aciTreeLi").length>0)};var F=function(ae){return ae&&(ae.first().next(".aciTreeLi").length>0)};var Q=function(ae){return ae?ae.first().parent().find(">.aciTreeLi").not(ae):a([])};var e=function(ae){return ae?ae.first().prev(".aciTreeLi"):a([])};var B=function(ae){return ae?ae.first().next(".aciTreeLi"):a([])};var g=function(ae){var af=-1;if(ae){ae=ae.first();while(ae.hasClass("aciTreeLi")){ae=ae.parent().parent();af++}}return af};var Z=function(ae){return ae?ae.first().data("id"+a.aciTree.nameSpace):null};var c=function(ae){return(ae?ae.first().find(">.aciTreeItem").text():null)};var t=function(af){if(af){var ae="id"+a.aciTree.nameSpace;q.find(".aciTreeLi").each(function(){if(a(this).data(ae)==af){return a(this)}})}return a([])};var n=function(ae){return ae&&(ae.length==1)&&ae.hasClass("aciTreeLi")};var ab=function(af,ae){if(af){af=af.first();if(n(af)&&!y(af)){var ag=g(af);if(ae.length){af.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder");I(af,ae,ag+1,false)}else{U(af)}af.find(">.aciTreeButton").removeClass("aciTreeLoad")}}else{if(!y()){q.html("");if(ae.length){I(q,ae,0,X.options.animateRoot);if(!X.options.animateRoot){q.find(">.aciTreeUl").show()}}q.removeClass("aciTreeLoad")}}};var S=function(ae,af){if(ae){ae.each(function(){var ag=a(this);if(n(ag)&&!y(ag)){ag.find(">.aciTreeButton").addClass("aciTreeLoad");var ah=g(ag);a.get(X.options.json+Z(ag),null,function(ai){if(ai&&ai.length){ag.removeClass("aciTreeFolderMaybe").addClass("aciTreeFolder");I(ag,ai,ah+1,false);if(af){af()}}else{U(ag)}ag.find(">.aciTreeButton").removeClass("aciTreeLoad")},"json")}})}else{if(!y()){q.addClass("aciTreeLoad");a.get(X.options.json,null,function(ag){q.html("");if(ag&&ag.length){I(q,ag,0,X.options.animateRoot);if(!X.options.animateRoot){q.find(">.aciTreeUl").show()}}q.removeClass("aciTreeLoad")},"json")}}};var o=function(ae){if(!ae){ae=q}return ae.first().find(">.aciTreeUl>.aciTreeLi:first")};var P=function(ae){if(!ae){ae=q}return ae.first().find(">.aciTreeUl>.aciTreeLi:last")};var d=function(af,ah,ae){var ag=o(af);while(ag.length){if(R(ag)){if(!ae){ah(q,ag)}d(ag,ah,ae);if(ae){ah(q,ag)}}else{ah(q,ag)}ag=B(ag)}};var m=function(){if((typeof w=="undefined")||(typeof w=="object")){if(X.options.autoInit){T()}}else{if(typeof w=="string"){switch(w){case"init":T();break;case"api":return{itemFrom:aa,getId:Z,getText:c,getLevel:g,byId:t,isItem:n,isFile:ad,isFolder:R,wasLoad:y,empty:b,remove:x,setFolder:A,setFile:U,setIcon:N,haveParent:l,getParent:O,getPath:r,addAfter:Y,addBefore:D,addChildren:H,toggle:z,doOpen:E,doClose:h,isOpen:f,isClosed:L,haveSiblings:p,havePrev:i,haveNext:F,haveChildrens:ac,siblings:Q,getFirst:o,getLast:P,getPrev:e,getNext:B,childrens:W,doInit:ab,doLoad:S,branch:d};case"option":if(X){X.options[J]=M;q.data(a.aciTree.nameSpace,X)}break;case"options":return X?X.options:null;case"destroy":if(X){b();q.off(a.aciTree.nameSpace,".aciTreeButton");q.data(a.aciTree.nameSpace,null)}break}}}return q};return m()}})(jQuery);
